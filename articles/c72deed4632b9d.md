---
title: "OpenAPIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ›¸ã„ã¦ä½œã£ã¦å…¬é–‹ã™ã‚‹"
emoji: "ğŸ“"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["oas", "swagger", "redoc", "vscode", "golang"]
published: false
publication_name: "robon"
---

# ã¯ã˜ã‚ã«

ã“ã‚Œã¾ã§ã„ãã¤ã‹ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ›ãƒ¼ãƒ ã§ RESTful ãª WebAPI ã‚µãƒ¼ãƒãƒ¼ã‚’ä½œã‚‹è¨˜äº‹ã‚’æ›¸ã„ã¦ãã¾ã—ãŸã€‚ãã—ã¦ã€WebAPI ã®ä»•æ§˜æ›¸ã¨ã—ã¦ã¯ã€ãƒ‡ãƒ•ã‚¡ã‚¯ãƒˆã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰çš„ãªä½ç½®ã¥ã‘ã® OpenAPI ã®ä»•æ§˜ã«ã¤ã„ã¦ã‚‚è¨˜äº‹ã‚’æ›¸ã„ã¦ãã¾ã—ãŸã€‚

ä»Šå›ã¯ã€OpenAPI ä»•æ§˜ã«åŸºã¥ã„ãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ›¸ã„ã¦ã€ãƒ–ãƒ©ã‚¦ã‚¶ã§è¡¨ç¤ºå¯èƒ½ãªãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä½œã‚Šã€WebAPI ã‚µãƒ¼ãƒã«åŒæ¢±ã—ã¦å…¬é–‹ã™ã‚‹ã¨ã„ã†å†…å®¹ã«ãªã‚Šã¾ã™ã€‚

# æ›¸ã

ã“ã‚Œã¾ã§ã® WebAPI ã‚µãƒ¼ãƒã¨åŒã˜ãŠé¡Œã§ä½œã‚Šã¾ã™ï¼ˆãŒã€å…¬é–‹ãƒªãƒã‚¸ãƒˆãƒªã§ã¯æœªå®Ÿè£…ã®éƒ¨åˆ†ã‚‚æ‹¡å¼µã—ã¾ã™ï¼‰ã€‚openapi.yaml ã¨ã‹ openapi.json ã¨ã‹ãƒãƒ©è¦‹ã—ãŸã“ã¨ãŒã‚ã‚‹ã®ã§ã™ãŒã€ã‚ã‚“ãªé•·ã„å‘ªæ–‡ã‚’æ›¸ãã®ã¯å³ã—ã„ã§ã™ã€‚

## ç’°å¢ƒ

ã‚‚ã†ã™ã£ã‹ã‚Š VSCode ç„¡ã—ã§ã¯ç”Ÿãã¦ã„ã‘ãªã„çŠ¶æ…‹ãªã®ã§ã€VSCode ä¸Šã§ OpenAPIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ›¸ããŸã‚ã®ç’°å¢ƒã‚’ä½œã‚Šã¾ã™ã€‚ãƒã‚¿ãƒãƒ¬çš„ã«ã¯ã€[ä½œã‚‹](#ä½œã‚‹) ã§ ReDocly CLI ã‚’ä½¿ã†ã“ã¨ã‚‚ã‚ã‚Šã€ReDocly OpenAPI æ‹¡å¼µã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

https://marketplace.visualstudio.com/items?itemName=Redocly.openapi-vs-code

ã“ã‚Œã§ã€ã‚³ãƒ¼ãƒ‰ã‚¢ã‚·ã‚¹ãƒˆã‚„ ~~ï¼ˆãŠç¯€ä»‹ãªï¼‰~~ è­¦å‘Šã‚’å‡ºã—ã¦ãã‚Œã‚‹ã®ã§ã€å®‰å¿ƒã—ã¦é€²ã‚ã‚‰ã‚Œãã†ã§ã™ã€‚
ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãªå…¥åŠ›ã‚‚ç›®æŒ‡ã—ã¦é ‘å¼µã£ã¦é–‹ç™ºã—ã¦ãã‚Œã¦ã„ã¾ã™ãŒã€å°†æ¥ã«æœŸå¾…ã€‚ã¨ã„ã†ã“ã¨ã§ç´ é€šã‚Šã—ã¾ã™ã€‚

## æ§‹æˆ

ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã£ã¦æ›¸ãã‚„ã™ãã¯ãªã£ãŸã®ã§ã™ãŒã€è­¦å‘Šã®æ´—ç¤¼ã‚’å—ã‘ãªãŒã‚‰ã€ã‚ã‚“ãªé•·ã„å‘ªæ–‡ã‚’æ›¸ãã®ã¯å¿ƒãŒæŠ˜ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚OpenAPI ä»•æ§˜ã§ã¯ã€æ§˜ã€…ãªç®‡æ‰€ã§ [Referenceã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ](https://zenn.dev/robon/articles/518f1f4769301f#reference%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88) ã‚’ä½¿ã†ã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã‚Œã‚’ä½¿ã£ã¦ã€åˆ†å‰²çµ±æ²»ã‚’è©¦è¡ŒéŒ¯èª¤ã—ãŸçµæœã€ä»¥ä¸‹ã®ã‚ˆã†ãªæ§‹æˆã«ã—ã¾ã™ã€‚

```bash
$ tree openapi
openapi
â”œâ”€â”€ customers
â”‚   â”œâ”€â”€ collection.yaml
â”‚   â”œâ”€â”€ identified.yaml
â”‚   â”œâ”€â”€ key.yaml
â”‚   â”œâ”€â”€ query.yaml
â”‚   â””â”€â”€ resource.yaml
â”œâ”€â”€ main.yaml
```

## æ›¸ã„ãŸ
### ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«

ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã® yaml ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ã‚ˆãè¦‹ã‚‹ã‚‚ã®ã¨ä¼¼ã¦ã„ã¾ã™ãŒã€paths ã® [Path Itemã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ](https://zenn.dev/robon/articles/518f1f4769301f#path-item%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88) ã‚’ã¾ã‚‹ã£ã¨å¤–ã«å‡ºã—ã¾ã™ã€‚

```yaml: main.yaml
openapi: 3.1.0

info:
  title: sample
  version: 1.0.0
  description: Veleta ã§è‡ªå‹•ç”Ÿæˆã—ãŸ API Server ã® Golang ç‰ˆã®ã‚µãƒ³ãƒ—ãƒ«
  license:
    name: Creative Commons Attribution Non Commercial Share Alike 4.0 International
    identifier: CC-BY-NC-SA-4.0
    url: https://creativecommons.org/licenses/by-nc-sa/4.0/legalcode

servers:
  - url: "http://localhost:3000"
    description: å†…éƒ¨ã® API Server æœ¬ä½“

paths:
  /customers:
    $ref: customers/collection.yaml
  /customers/{customerId}:
    $ref: customers/identified.yaml
  /products:
    $ref: products/collection.yaml
  /products/{productId}:
    $ref: products/identified.yaml
  /orders:
    $ref: orders/collection.yaml
  /orders/{orderId}:
    $ref: orders/identified.yaml      

components:
  securitySchemes:
    basicAuth:
      type: http
      scheme: basic

security:
  - basicAuth: []
```

### Path Item

ã¾ãã€ã ã„ãŸã„ã€ãƒªã‚½ãƒ¼ã‚¹ã®é›†åˆã«å¯¾ã—ã¦ã®å‘¼ã³å‡ºã—ã‹ã€ç‰¹å®šã®ãƒªã‚½ãƒ¼ã‚¹ã‚’æŒ‡å®šã—ãŸå‘¼ã³å‡ºã—ã«ãªã‚Šã¾ã™ã‚ˆã­ã€‚

```yaml: collection.yaml
post:
  operationId: postCustomer
  summary: é¡§å®¢ã®ç™»éŒ²
  description: é¡§å®¢ã‚’æ–°è¦ç™»éŒ²ã™ã‚‹
  requestBody:
    content:
      application/json:
        schema:
          $ref: resource.yaml
          required:
            - customerId
            - name
            - address
  responses:
    "200":
      description: OK
      content:
        application/json:
          schema:
            $ref: resource.yaml
    "400":
      description: Bad Request
    "404":
      description: Not Found
    "409":
      description: Conflict
    "500":
      description: Internal Server Error

get:
  operationId: queryCustomers
  summary: é¡§å®¢ã®æŠ½å‡º
  description: é¡§å®¢ã‚’æ¤œç´¢ã™ã‚‹
  parameters:
    $ref: "./query.yaml"
  responses:
    "200":
      description: OK
      content:
        application/json:
          schema:
            type: array
            items:
              $ref: resource.yaml
    "400":
      description: Bad Request
    "404":
      description: Not Found
    "500":
      description: Internal Server Error
```

ç™»éŒ²ã¨ã‚¯ã‚¨ãƒªã®å ´åˆã¯ã€å…¥å‡ºåŠ›ã§ãƒªã‚½ãƒ¼ã‚¹ã®ã‚¹ã‚­ãƒ¼ãƒã‚’å®šç¾©ã™ã‚‹ã‚“ã§ã™ãŒã€ãã“ã‚‚å¤–å‡ºã—ã«ã—ã¾ã™ã€‚ã‚¯ã‚¨ãƒªã®å ´åˆã¯ã€åŠ ãˆã¦ã€ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚‚å®šç¾©ã™ã‚‹ã‚“ã§ã™ãŒã€ã“ã“ã¯ã“ã“ã—ã‹ä½¿ã‚ãªã„ã®ã§ã™ãŒã€å…¨ä½“ã®ãƒãƒ©ãƒ³ã‚¹ã‚’ã¨ã‚‹ãŸã‚ã«å¤–å‡ºã—ã«ã—ã¾ã—ãŸã€‚

```yaml: identified.yaml
get:
  operationId: getCustomer
  summary: é¡§å®¢ã®å–å¾—
  description: è­˜åˆ¥å­ã§æŒ‡å®šã—ãŸé¡§å®¢ã‚’å–å¾—ã™ã‚‹
  parameters:
    $ref: key.yaml
  responses:
    "200":
      description: OK
      content:
        application/json:
          schema:
            $ref: resource.yaml
    "400":
      description: Bad Request
    "404":
      description: Not Found
    "500":
      description: Internal Server Error
        
put:
  operationId: putCustomer
  summary: é¡§å®¢ã®æ›´æ–°
  description: è­˜åˆ¥å­ã§æŒ‡å®šã—ãŸé¡§å®¢ã‚’æ›´æ–°ã™ã‚‹
  parameters:
    $ref: key.yaml
  requestBody:
    content:
      application/json:
        schema:
          $ref: resource.yaml       
  responses:
    "200":
      description: OK
      content:
        application/json:
          schema:
            $ref: resource.yaml
    "400":
      description: Bad Request
    "404":
      description: Not Found
    "500":
      description: Internal Server Error
        
delete:
  operationId: deleteCustomer
  summary: é¡§å®¢ã®å‰Šé™¤
  description: è­˜åˆ¥å­ã§æŒ‡å®šã—ãŸé¡§å®¢ã‚’å‰Šé™¤ã™ã‚‹
  parameters:
    $ref: key.yaml
  responses:
    "200":
      description: OK
    "400":
      description: Bad Request
    "404":
      description: Not Found
    "500":
      description: Internal Server Error
```

ãƒªã‚½ãƒ¼ã‚¹ã®ã‚­ãƒ¼æŒ‡å®šã¯ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ãªã‚‹ã®ã§ã™ãŒã€ã“ã“ã‚‚å¤–å‡ºã—ã«ã—ã¾ã™ã€‚

### Schema

çµæœã€å¤–å‡ºã—ã•ã‚ŒãŸæ®‹ã‚Šã¨ãªã‚‹æœ«ç«¯ã®ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã€ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒœãƒ‡ã‚£éƒ¨ã‚’å®šç¾©ã—ã¾ã™ã€‚

```yaml: key.yaml
- name: customerId
  in: path
  description: é¡§å®¢ã®è­˜åˆ¥å­
  schema:
    type: integer
    format: int64
```
```yaml: query.yaml
- name: name
  in: query
  description: é¡§å®¢ã®æ°å
  schema:
    type: array
    items: 
      type: string
- name: address
  in: query
  description: é¡§å®¢ã®ä½æ‰€
  schema:
    type: array
    items: 
      type: string
- name: limit
  in: query
  description: æœ€å¤§ä»¶æ•°
  schema:
    type: integer
    minimum: 1
    maximum: 100
    default: 100
- name: customerId
  in: query
  description: æ¤œç´¢æ¸ˆã¿ã®é¡§å®¢ã®è­˜åˆ¥å­
  schema:
    type: integer
    format: int64
```
```yaml: resource.yaml
type: object
properties: 
  customerId:
    title: é¡§å®¢ID
    description: é¡§å®¢ã®è­˜åˆ¥å­
    type: integer
    format: int64
  name:
    title: æ°å
    description: é¡§å®¢ã®æ°å
    type: string
    minLength: 1
    maxLength: 16
  address:
    title: ä½æ‰€
    description: é¡§å®¢ã®ä½æ‰€
    type: string
    minLength: 1
    maxLength: 128
```

ã¨ã€ã“ã‚“ãªæ„Ÿã˜ã§ã‚ã‚Œã°ã€ãã‚Œãã‚Œã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›¸ãéš›ã«çŸ¥ã£ã¦ã„ãªã„ã‘ã‚Œã°ã„ã‘ãªã„æƒ…å ±ãŒé™å®šã•ã‚Œã‚‹ã®ã§ã€ã“ã‚Œãªã‚‰æ›¸ã‘ãã†ã ãªã¨æ€ã£ã¦ã‚‚ã‚‰ãˆã‚‹ã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ã€‚

å·¥å¤«ã—ãŸç‚¹ã¨ã—ã¦ã¯ã€åŒã˜ãƒªã‚½ãƒ¼ã‚¹ã®ã‚¹ã‚­ãƒ¼ãƒã§ã‚‚ã€å¿…é ˆæ¡ä»¶ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€ç™»éŒ²ãªã®ã‹ã€æ›´æ–°ãªã®ã‹ã€å‚ç…§ãªã®ã‹ã«ã‚ˆã£ã¦ç•°ãªã‚Šã¾ã™ã®ã§ã€ãƒªã‚½ãƒ¼ã‚¹å´ã§ã¯æŒ‡å®šã§ãã¾ã›ã‚“ã€‚ã“ã®ãŸã‚ã€ä¸Šè¨˜ã§ã¯ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒæ±ºå®šã™ã‚‹ [Operationã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ](https://zenn.dev/robon/articles/518f1f4769301f#operation%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88) å†…ã® Schema ã§ `$ref` ã¨ `required` ã‚’æ··ãœã¦å®šç¾©ã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚

# ä½œã‚‹

OpenAPI ã§ä½œã‚‹ä»•æ§˜æ›¸ã¨è¨€ãˆã° [Swagger UI](https://swagger.io/tools/swagger-ui/) ãªã‚“ã§ã—ã‚‡ã†ã‘ã©ã€çµ„ç¹”ã®å†…éƒ¨ã§å°ã•ãä½¿ã† API Server ã®ä»•æ§˜æ›¸ã®ãŸã‚ã« Web ã‚µãƒ¼ãƒç”¨æ„ã™ã‚‹ã®ï¼Ÿã¨ã‹ã‚ã‚‹ã¨æ€ã†ã®ã§ã€HTMLãƒ•ã‚¡ã‚¤ãƒ«ï¼‘æœ¬ã®æ¼¢ã‚‰ã—ã„ [ReDocly CLI](https://redocly.com/docs/cli/) ã§ä½œã‚Šã¾ã™ã€‚

## ç’°å¢ƒ

ReDocly CLI ã¯ã€Node.js ã§å‹•ããƒ„ãƒ¼ãƒ«ãªã®ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```bash
$ npm i -g @redocly/cli@latest
$ redocly --version
1.0.0-beta.127
```

## ä½œã£ãŸ

ã¾ãã€å‘¼ã¶ã ã‘ã§ã™ã€‚

```bash
$ redocly build-docs ./openapi/main.yaml --output=./server/spec/openapi.html --theme.openapi.disableSearch
Prerendering docs
ğŸ‰ bundled successfully in: ./server/spec/openapi.html (163 KiB) [â± 17ms].
```

å‡ºæ¥ä¸ŠãŒã‚ŠãŒè¦‹ãŸã„æ–¹ã€github ä¸Šã® [openapi.html](https://take0a.github.io/openapi-sample/server/spec/openapi.html) ã§ã™ã€‚ã„ã‹ãŒã§ã—ã‚‡ã†ã‹ã€‚

# å…¬é–‹ã™ã‚‹

ä»•æ§˜æ›¸ã‚’ç´å“ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«åã‚ã¦ãŠã„ã¦ã‚‚ã€ã©ã“ã‹ã¸è¡Œã£ã¦ã—ã¾ã†ã ã‘ã®ã‚ˆã†ãªæ°—ã‚‚ã—ã¾ã™ã®ã§ã€WebAPI ã‚µãƒ¼ãƒã«ãƒ›ã‚¹ãƒˆã•ã›ã¦ã¿ã¾ã™ã€‚

## ç’°å¢ƒ

ä»Šå›ã‚‚ Golang ã§è¡Œãã¾ã™ã€‚

```bash
$ go version
go version go1.19.9 linux/amd64
$ go mod init github.com/take0a/openapi-sample
go: creating new go.mod: module github.com/take0a/openapi-sample
go: to add module requirements and sums:
        go mod tidy
$ go mod tidy
```

## åŸ‹ã‚è¾¼ã‚€

[go:embed](https://pkg.go.dev/embed) ã‚’ä½¿ã†ã¨ç°¡å˜ã«å®Ÿç¾ã§ãã¾ã™ã€‚

```go: main.go
package main

import (
	"embed"
	"net/http"
)

//go:embed spec
var spec embed.FS

func main() {
	http.Handle("/spec/", http.FileServer(http.FS(spec)))
	http.ListenAndServe(":3000", nil)
}
```

ã“ã‚Œã ã‘ã§ã™ã€‚

# ãŠã‚ã‚Šã«

ã„ã‹ãŒã§ã—ãŸã§ã—ã‚‡ã†ã‹ã€‚ç°¡å˜ãã†ã ãªã¨æ€ã£ã¦é ‚ã‘ãŸã‚‰ã€ã“ã®è¨˜äº‹ã¯æˆåŠŸã§ã™ã€‚
ä»Šå›ã®è¨˜äº‹ã§ä½¿ç”¨ã—ãŸãƒªã‚½ãƒ¼ã‚¹ã‚’ github ã§å…¬é–‹ã—ã¾ã—ãŸã€‚

https://github.com/take0a/openapi-sample
