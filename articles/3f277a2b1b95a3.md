---
title: "NestJSでREST（その４）"
emoji: "🦁"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["nestjs", "rest", "postgresql", "nodejs", "typescript"]
published: false
publication_name: "robon"
---
# 前回まで

https://zenn.dev/robon/articles/f5e5907aa871a5

一旦、動きました。👏

# 仕上げ
## 設定が丸見え

Node.jsのプロジェクトでよくあるような.envにします。

```.env.dev
DB_HOST=host
DB_USER=user
DB_PASS=pass
```

### @nestjs/configの導入と設定

```bash
$ npm i --save @nestjs/config
```

インストールできたら、app.modules.tsを変更してお見せできる状態にします。

```ts:app.modules.ts
import { Module } from '@nestjs/common';
import { ConfigModule, ConfigService } from '@nestjs/config';
import { TypeOrmModule } from '@nestjs/typeorm';
import { AppController } from './app.controller';
import { AppService } from './app.service';
import { CustomersModule } from './customers/customers.module';
import { Customer } from './customers/entities/customer.entity';

@Module({
  imports: [
    ConfigModule.forRoot({
      envFilePath: '.env.dev',
    }),
    TypeOrmModule.forRootAsync({
      imports: [ConfigModule],
      useFactory: (configService: ConfigService) => ({
        type: 'postgres',
        host: configService.get('DB_HOST'),
        port: 5432,
        username: configService.get('DB_USER'),
        password: configService.get('DB_PASS'),
        database: 'postgres',
        entities: [Customer],
        logging: true,
        synchronize: false,
      }),
      inject: [ConfigService],
    }),
    CustomersModule,
  ],
  controllers: [AppController],
  providers: [AppService],
})
export class AppModule {}
```

以下のドキュメントに説明がありますが、forRootからforRootAsyncに変更しています。

https://docs.nestjs.com/techniques/database


## 最初にやりたかったこと

最初にやりたかった全体像は、その１を参照ください。

https://zenn.dev/robon/articles/76d4ec767b72ae

### productsの追加

独立エンティティ単体なので、customersと同様に作るだけです。

### ordersの追加



# 最後に

