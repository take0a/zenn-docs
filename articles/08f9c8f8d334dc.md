---
title: "å…¬å¼ã‚µãƒ³ãƒ—ãƒ«ã‚’å…¬å¼Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã«å…¥ã‚Œã‚‹ï¼ˆOracleç·¨ï¼‰"
emoji: "ğŸ¦­"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["docker", "oracle", "sql"]
published: true
publication_name: "robon"
---

# ã¯ã˜ã‚ã«
ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒæ¬²ã—ããªã£ãŸã®ã§ã™ãŒã€æœ€è¿‘ã¯è¦‹ã‹ã‘ãªã„ã‚ˆã†ãªæ°—ãŒã—ã¾ã™ã€‚
æ˜”ã€…ã¯ã€scott/tiger ã§ã¤ãªã„ã§ EMP ãƒ†ãƒ¼ãƒ–ãƒ«ã§ç·´ç¿’ã™ã‚‹ã®ãŒãŠç´„æŸã§ã—ãŸãŒâ€¦ã€‚
èª¿ã¹ã¦ã¿ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚

æœ€åˆã¯ã€ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®å ´æ‰€ã ã‘ã®å‚™å¿˜éŒ²ã«ã—ã‚ˆã†ã¨æ€ã£ãŸã®ã§ã™ãŒã€ã¡ã‚‡ã£ã¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½¿ã£ãŸãƒ‡ãƒ¢ã¨ã‹ãƒ†ã‚¹ãƒˆãŒå¿…è¦ã«ãªã£ãŸã®ã§ã€ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å…¥ã‚Šã® Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œã£ã¦ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œã‚‹ææ–™ã‚‚ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚‚å…¬é–‹ã—ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚

# Oracle ç·¨
MySQL ã«ã¯ä¼¼ãŸã‚ˆã†ãªè¨˜äº‹ãŒã„ãã¤ã‹ã‚ã‚Šã¾ã™ï¼ˆè‹¦ç¬‘ï¼‰ã€‚
åŸºæœ¬çš„ã«ã¯ã€ä»¥å‰ã® PostgreSQL ã®æ´¾ç”Ÿå½¢ï¼ˆã¨æ€ã„ã¾ã™ï¼‰ãªã®ã§ã€åŒã˜ã§ã™ã€‚
https://zenn.dev/robon/articles/6071ebdff6e2f5

## å…¬å¼ Docker ã‚¤ãƒ¡ãƒ¼ã‚¸
ã‚ªãƒ•ã‚£ã‚·ãƒ£ãƒ«ã‚¤ãƒ¡ãƒ¼ã‚¸ã¯ã€ä»¥ä¸‹ã«ã‚ã‚Šã¾ã™ã€‚
https://container-registry.oracle.com/ords/ocr/ba/database

ã“ã“ã‹ã‚‰ free ã‚’é¸ã‚“ã§ã€2.42GBï¼ã® full ã§ã¯ãªãã¦ 871MB ã® lite ã‚’é¸æŠã—ã¾ã—ãŸã€‚

ã“ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã—ã¦ã„ã‚‹ã®ãŒã€ä»¥ä¸‹ã§ã™ï¼ˆã¨æ€ã„ã¾ã™ï¼‰ã€‚
https://github.com/oracle/docker-images

GitHub ã®ã‚ªãƒ¼ãƒŠãƒ¼ã¯ `oracle` ã•ã‚“ï¼ˆã¨æ€ã„ã¾ã™ï¼‰ã€‚
ã“ã“ã® `OracleDatabase/SingleInstance/dockerfiles/23.4.0` ãŒãã‚Œï¼ˆã¨æ€ã„ã¾ã™ï¼‰ã€‚
Containerfile.free ã®ä¸­ã® `/docker-entrypoint-initdb.d/` ãªã©ã«ç—•è·¡ãŒæ®‹ã£ã¦ã„ã‚‹ï¼ˆã¨æ€ã„ã¾ã™ï¼‰ã€‚

ã“ã®ã‚ªãƒ•ã‚£ã‚·ãƒ£ãƒ«ã‚¤ãƒ¡ãƒ¼ã‚¸ã® `Running Scripts After Setup and On Startup` ã«æ›¸ã‹ã‚Œã¦ã„ã¾ã™ã€‚

> The Container images can be configured to run scripts after setup and on startup. Currently, .sh and .sql extensions are supported. For post-setup scripts, mount the volume /opt/oracle/scripts/setup to include scripts in this directory. For post-startup scripts, mount the volume /opt/oracle/scripts/startup to include scripts in this directory.

> After the database is set up or started, the scripts in those folders are run against the database in the container. SQL scripts are run as SYSDBA, and shell scripts are run as the current user. To ensure proper order for running scripts, Oracle recommends that you prefix your scripts with a number. For example: 01_users.sql, 02_permissions.sql, and so on.

ãªã®ã§ã€Oralce ã§ã¯ã€`.sql` ã‚„ `.sh` ã‚’ `/opt/oracle/scripts/startup` ã«ç½®ã„ã¦ãŠã‘ã°è‰¯ã„ã¨ã„ã†ã“ã¨ã§ã™ã€‚

## å…¬å¼ã‚µãƒ³ãƒ—ãƒ«
å…¬å¼ã‚µãƒ³ãƒ—ãƒ«ã¯ã€ä»¥ä¸‹ã«ã‚ã‚Šã¾ã—ãŸã€‚
https://docs.oracle.com/cd/F19136_01/comsc/index.html

ã“ã“ã® `2 ã‚µãƒ³ãƒ—ãƒ«ãƒ»ã‚¹ã‚­ãƒ¼ãƒã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«` ã§ã€[GitHub](https://github.com/oracle-samples/db-sample-schemas) ã«ãŸã©ã‚Šç€ãã¾ã™ã€‚
ä»Šå›ã¯ã€[Customer Orders Sample Schema](https://github.com/oracle-samples/db-sample-schemas/tree/main/customer_orders) ã‚’çµ„ã¿è¾¼ã‚€ã“ã¨ã«ã—ã¾ã™ã€‚


## Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œã‚‹
æœ¬å½“ã¯ã€ä½œã‚‰ãªãã¦ã‚‚ã€`/opt/oracle/scripts/startup/` ã‚’ `-v` ã§ãƒã‚¦ãƒ³ãƒˆã™ã‚Œã°çµ‚äº†ãªã‚“ã ã‘ã©ã€çµ„ã¿è¾¼ã‚“ã§ã—ã¾ã£ãŸæ–¹ãŒæ¥½ãªã‚“ã˜ã‚ƒãªã„ã®ï¼Ÿã¨ã„ã†ã“ã¨ã§ä½œã‚Šã¾ã™ã€‚

### SQLãƒ•ã‚¡ã‚¤ãƒ«
[Customer Orders Sample Schema](https://github.com/oracle-samples/db-sample-schemas/tree/main/customer_orders) ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚
`co_install.sql` ãŒãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚„ãƒ†ãƒ¼ãƒ–ãƒ«ã‚¹ãƒšãƒ¼ã‚¹ã‚’å—ã‘å–ã£ã¦ã„ã‚‹ç®‡æ‰€ã‚’å›ºå®šå€¤ã«ä¿®æ­£ã—ã¾ã™ã€‚ã¾ãŸã€å®Ÿè¡Œãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ã¯ç•°ãªã‚‹ã®ã§ã€å‘¼ã³å‡ºã—ã‚’ãƒ•ãƒ«ãƒ‘ã‚¹ã«å¤‰æ›´ã—ã¾ã™ã€‚è©³ã—ãã¯æœ«å°¾ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’å‚ç…§ãã ã•ã„ã€‚

### Dockerfile
```dockerfile: Dockerfile
FROM container-registry.oracle.com/database/free:23.4.0.0-lite
RUN mkdir -p /opt/oracle/scripts/startup/co/
COPY ./customer_orders/co_install.sql /opt/oracle/scripts/startup/01.sql
COPY ./customer_orders/co_create.sql /opt/oracle/scripts/startup/co/co_create.sql
COPY ./customer_orders/co_populate.sql /opt/oracle/scripts/startup/co/co_populate.sql
```
ã‚³ãƒ”ãƒ¼å…ˆã‚’ `01.sql` ã«ã—ã¦ã„ã‚‹ã®ã¯ã€ã‚ªãƒ•ã‚£ã‚·ãƒ£ãƒ«ã‚¤ãƒ¡ãƒ¼ã‚¸ã«æ›¸ã„ã¦ã‚ã£ãŸ `Oracle recommends that you prefix your scripts with a number.` å¯¾ç­–ã§ã™ã€‚
åœ§ç¸®ã—ã¦ã„ãªã„ã®ã¯ã€Oracle ã•ã‚“ã® `OracleDatabase/SingleInstance/dockerfiles/23.4.0/runUserScripts.sh` ãŒã€åœ§ç¸®ãƒ•ã‚¡ã‚¤ãƒ«å¯¾å¿œã‚’ã—ã¦ã„ãªã„ã‹ã‚‰ã§ã™ã€‚åŒã˜ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®è¨˜è¿°ã®ã¨ãŠã‚Šã€å‘¼ã³å‡ºã—ãƒ•ã‚¡ã‚¤ãƒ«ã¯ãƒ•ãƒ©ãƒƒãƒˆã«ç½®ãã¨å‡¦ç†ã•ã‚Œã¦ã—ã¾ã†ã®ã§ã€ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®ã—ã¦ã„ã¾ã™ã€‚

### Makefile
```makefile: Makefile
.PHONY: build run push clean

IMAGE=docker.io/take0a/oracle-co
CONTAINER=oracle01
PASSWORD=password

build: clean
	docker build . -t $(IMAGE) --no-cache

run:
	docker run --name $(CONTAINER) -dit -e ORACLE_PWD=$(PASSWORD) $(IMAGE)
	docker exec -it $(CONTAINER) /bin/bash

push:
	docker push $(IMAGE)

clean:
	docker container rm $(CONTAINER) -f
	docker image rm $(IMAGE) -f
```
ã“ã‚“ãªæ„Ÿã˜ã«ã—ã¦ãŠãã¨ã€ã‚³ãƒãƒ³ãƒ‰ã‚’å¿˜ã‚Œã¦ã€Œã‚ã‚ã‚ã€ã—ãªãã¦ã™ã¿ã¾ã™ã€‚

## Docker ã‚¤ãƒ¡ãƒ¼ã‚¸
ä»¥ä¸‹ã§å…¬é–‹ã—ã¾ã—ãŸã€‚
https://hub.docker.com/r/take0a/oracle-co

`docker pull take0a/oracle-co` ã§ pull ã§ãã¾ã™ã€‚

## GitHub ãƒªãƒã‚¸ãƒˆãƒª
ä»¥ä¸‹ã§å…¬é–‹ã—ã¾ã—ãŸã€‚
https://github.com/take0a/docker-library/tree/main/oracle

ä»–ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚‚ã®ã‚‚å…¬é–‹ã—ãŸã‚‰ã€å°‘ã—ãã‚Œã„ã«ã—ã¦ãŠãã¾ã™ã€‚

# ãŠã‚ã‚Šã«
ã‚„ã¯ã‚Šã€ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¯å¿…è¦ã§ã™ã‚ˆã­ã€‚
