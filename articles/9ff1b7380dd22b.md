---
title: "uvで学ぶPythonの基礎"
emoji: "🐍"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["python", "uv"]
published: false
publication_name: "robon"
---

# はじめに

いろいろありまして、Python やることになりました。

ちょっと前には、FastAPI の記事を書いたり、第二新卒の社員向けに Python でプログラミングの基礎を教えてたりしたんですが、最近は、uv らしいというのを見かけて、uv って何？ということで勉強しはじめたら、知らないことばかりで、いまさらではあるのですが、これはまずいということで基礎から学ばないと…という記事です。

# まなぶ

https://docs.astral.sh/uv/

とりあえず、本家のドキュメント読め。が鉄則ですよね。Introduction、Getting started から Guide の Running scripts で仮想環境がぁというあたりから怪しくなってきたので、Concepts をしっかりやろうと思います。

uv の中の人は（たぶん、uv の普通のユーザーさんも）、Project が興味の対象と思うので、Project からになってますが、自分としては、Python versions やらないとスッキリしなかったので、Python versions からにします。

## [Python](https://docs.astral.sh/uv/concepts/python-versions/)

Python のある特定のバージョンとは、Python インタープリターと標準ライブラリとその他のサポートファイルで構成されます。

Python = python インタープリター + 標準ライブラリ + その他のサポートファイル？

その他のサポートファイルには、サードパーティパッケージやエントリポイントスクリプトが含まれるようです。ここで、1 つの Python の環境には、同じパッケージの複数のバージョンをインストールすることができないという制約とどう付き合うかということがポイントになってきます。

uv は、uv が管理する Python のインストール（managed）とそれ以外の Python のインストール（system）を検出できます。

これらの Python のインストールを使って、仮想環境を作るというのが、環境には同じパッケージの複数のバージョンをインストールすることができない問題の回避方法なので、当然のように仮想環境を前提とした話になっているのですね。

Python には、複数のディストリビューションがあることは知っていましたが、CPython の公式版がないということは知りませんでした。uv では、Astral 社のビルドを使用して managed の Python インストールが行われます。

デフォルトでは、system があれば、managed をダウンロードはしないようなので、絶対に managed を使いたいような場合は、`python-preference` で `only-managed` を設定します。

## [Project](https://docs.astral.sh/uv/concepts/projects/)

プロジェクトとは、複数のファイルにまたがる Python のコードの管理のためにあり、pyproject.toml ファイルで依存関係を定義できます。

pyproject.toml には、最低、名前とバージョンが含まれます。

```toml: pyproject.toml
[project]
name = "example"
version = "0.1.0"
```

uv.lock は、プロジェクト環境にインストールされている解決済みの性格なバージョンが含まれているので、バージョン管理して、再現可能なインストールに使用できます。uv.lock は、人間が読める TOML ファイルですが、手動での編集はしてはいけません。また、このファイルの Python 標準はなく、uv 固有なので、開発チームのツールは揃えることになる。

### アプリケーションとライブラリとパッケージ

アプリケーションは、main.py が置かれるので、Webサーバー、スクリプト、CLI とかでは、デフォルトのままか明示的に `--app` フラグを指定して `uv init` で作ります。

パッケージ・アプリケーションは、パッケージをビルドするアプリケーションなので、PyPI などに公開する場合は、`--package` フラグを指定して作ります。

ライブラリは、他のプロジェクトに使ってもらうものなので、パッケージとしてビルドすることになります。`--lib` フラグを指定して作ります。

パッケージ化しないアプリケーション以外は、`src` ディレクトリにソースコードが配置される `src` レイアウトが採用されます。これは、プロジェクトのトップレベルのディレクトリにソースコードを配置した場合に、カレントディレクトリがインポート対象となるのを防ぐ効果があるためです。

### 依存関係の定義

依存関係を定義するフィールドは、以下の４つです。
- `project.dependencies`: 公開された依存関係
- `project.optional-dependencies`: 公開されたオプションの依存関係
- `dependency-groups`: 開発のためのローカル依存関係
- `tool.uv.sources`: 開発中の依存関係の代替ソース



## [Tool](https://docs.astral.sh/uv/concepts/tools/)
## [依存関係の解決](https://docs.astral.sh/uv/concepts/resolution/)
## [キャッシュ](https://docs.astral.sh/uv/concepts/cache/)

# おわりに