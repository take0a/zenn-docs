---
title: "Golangã§RESTï¼ˆãã®ï¼“ï¼‰"
emoji: "ğŸƒâ€â™€ï¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["golang", "rest", "postgresql", "gochi"]
published: false
publication_name: "robon"
---

# å‰å›ã¯

https://zenn.dev/robon/articles/a81cc526cac283

å…¨ä½“ã®è¨­è¨ˆæ–¹é‡ã‹ã‚‰ã¯ã˜ã‚ã¦ã€RESTãƒªã‚½ãƒ¼ã‚¹æ¯ã«è¡Œã†å®Ÿè£…ã¾ã§èª¬æ˜ã—ã¾ã—ãŸã€‚

# å®Ÿè£…ã®ç¶šã
## main

```go: server/main.go
package main

import (
	"fmt"
	"log"
	"net/http"
	"os"

	"github.com/go-chi/chi/v5"
	"github.com/go-chi/chi/v5/middleware"

	"github.com/take0a/go-rest-sample/module/customers"
	"github.com/take0a/go-rest-sample/module/orders"
	"github.com/take0a/go-rest-sample/module/products"
)

func main() {
	dsn := os.Getenv("DSN")
	db, err := NewDB(dsn)
	if err != nil {
		log.Printf("NewDB error %s", err)
	}

	r := chi.NewRouter()
	r.Use(middleware.Logger)

	r.Mount("/customers", customers.NewRouter(db))
	r.Mount("/orders", orders.NewRouter(db))
	r.Mount("/products", products.NewRouter(db))

	port := os.Getenv("PORT")
	addr := fmt.Sprintf(":%s", port)
	err = http.ListenAndServe(addr, r)
	if err != nil {
		log.Printf("ListenAndServe error %s", err)
	}
}
```

RESTãƒªã‚½ãƒ¼ã‚¹ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ã€ãƒªã‚½ãƒ¼ã‚¹åã®ãƒ‘ã‚¹ã«ãã‚Œãã‚Œã®Routerã‚’Mountã—ã¾ã™ã€‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ¥ç¶šæ–‡å­—åˆ—ã‚„Webã‚µãƒ¼ãƒãƒ¼ã®ãƒãƒ¼ãƒˆç•ªå·ã¯ç’°å¢ƒå¤‰æ•°ã§æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚

ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ¥ç¶šã«ã¤ã„ã¦ã¯ã€ä¸‹è¨˜ã®ã¨ãŠã‚Šãªã®ã§ã€æœ€åˆã«åˆæœŸåŒ–ã—ã¦å„Contorollerã§å…±æœ‰ã—ã¾ã™ã€‚

> DB is a database handle representing a pool of zero or more underlying connections. It's safe for concurrent use by multiple goroutines.

https://pkg.go.dev/database/sql#DB

```go: server/db.go
package main

import (
	"database/sql"

	_ "github.com/lib/pq"
)

// NewDB ã¯ã€DBã‚’ç”Ÿæˆã—ã¾ã™ã€‚
func NewDB(dsn string) (*sql.DB, error) {
	db, err := sql.Open("postgres", dsn)
	if err != nil {
		return nil, err
	}
	return db, nil
}
```

# æœ€å¾Œã«

ä»Šå›ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ã€ä»¥ä¸‹ã®ãƒªãƒã‚¸ãƒˆãƒªã§å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚

https://github.com/take0a/go-rest-sample

# ãŠã¾ã‘

æŠ˜è§’ã€è¤‡æ•°ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã€åŒã˜äººãŒåŒã˜ãŠé¡Œã§å®Ÿè£…ã—ãŸã®ã§ã€ç°¡å˜ãªï¼ˆéå¸¸ã«é›‘ãªï¼‰æ€§èƒ½æ¯”è¼ƒã‚’ã—ã¦ã¿ã¾ã™ã€‚

## Golang
```log:
2023/04/17 04:46:24 
SELECT
CUSTOMER_ID, NAME, ADDRESS
FROM CUSTOMER
WHERE CUSTOMER_ID = $1 Query sql: no rows in result set
2023/04/17 04:46:24 Invalid URL Parameter 1 sql: no rows in result set
2023/04/17 04:46:24 "GET http://localhost:3000/customers/1 HTTP/1.1" from 127.0.0.1:50922 - 404 50B in 28.368497ms
2023/04/17 04:46:38 "POST http://localhost:3000/customers HTTP/1.1" from 127.0.0.1:50926 - 200 71B in 8.150732ms
2023/04/17 04:46:41 "GET http://localhost:3000/customers/1 HTTP/1.1" from 127.0.0.1:50930 - 200 71B in 7.527611ms
2023/04/17 04:46:43 "PUT http://localhost:3000/customers/1 HTTP/1.1" from 127.0.0.1:50932 - 200 69B in 8.352679ms
2023/04/17 04:46:47 "DELETE http://localhost:3000/customers/1 HTTP/1.1" from 127.0.0.1:50934 - 200 0B in 8.23396ms
```

## FastAPI
```log
INFO:     Application startup complete.
INFO:     process_time = 64.69178199768066 ms
INFO:     127.0.0.1:33852 - "GET /customers/1 HTTP/1.1" 404 Not Found
INFO:     process_time = 17.406940460205078 ms
INFO:     127.0.0.1:33856 - "POST /customers HTTP/1.1" 200 OK
INFO:     process_time = 5.305290222167969 ms
INFO:     127.0.0.1:33858 - "GET /customers/1 HTTP/1.1" 200 OK
INFO:     process_time = 17.63439178466797 ms
INFO:     127.0.0.1:33860 - "PUT /customers/1 HTTP/1.1" 200 OK
INFO:     process_time = 12.27569580078125 ms
INFO:     127.0.0.1:33862 - "DELETE /customers/1 HTTP/1.1" 200 OK
```

## NestJS
```log
[Nest] 22906  - 04/17/2023, 7:53:48 AM     LOG [NestApplication] Nest application successfully started +5ms
GET /customers/1
POST /customers
16.509488999843597 ms
GET /customers/1
4.531806997954845 ms
PUT /customers/1
7.968879997730255 ms
DELETE /customers/1
4.6412380039691925 ms
```

## ã¾ã¨ã‚

| Method |  Golang |  FastAPI |  NestJS  |
|--------|---------|----------|----------|
| POST   | 8.150 ms| 17.406 ms| 16.509 ms|
| GET    | 7.527 ms|  5.305 ms|  4.531 ms|
| PUT    | 8.352 ms| 17.634 ms|  7.968 ms|
| DELETE | 8.233 ms| 12.275 ms|  4.641 ms|
