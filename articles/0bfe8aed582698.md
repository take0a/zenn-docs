---
title: "dbt Artifactsから見たdbt"
emoji: "🛠"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["python", "dbt", "uv", "duckdb"]
published: false
publication_name: "robon"
---

# はじめに

dbt に入門してみて、SQL 書いて、設定を書くとイイ感じにデータを加工してくれるというのが、なんかしっくりこないというか。。。プログラマな私は、全てをプログラムで厳密に定義しつくせないのがもどかしいというか。。。

それでも、dbt の膨大なドキュメントを探索しているうちに、dbt Artifacts というものにたどり着きました。

https://docs.getdbt.com/reference/artifacts/dbt-artifacts

探していたのは、これかもしれない。。。

# dbt とは何か、dbt Artifacts とは何か

2025/5/29 に [2025 dbt launch Showcase](https://www.getdbt.com/blog/dbt-launch-showcase-2025-recap) に参加しました。その中で、CEO の Tristan Handy が言っていた

> I seriously, I still remember the fever dreams that I had back in 2016 of how I could build this awesome tools that stack tables and views recursively on top of each other to infinity, to views all the way down.

> 本当に、2016 年に私が抱いていた、テーブルとビューを無限に再帰的に積み重ね、ビューをずっと下まで積み重ねる素晴らしいツールを構築するという熱狂的な夢を今でも覚えています。

これが、dbt の本質なのだと思います。この夢へのツールの入力として、SQL と設定を投入している。その投入可能なすべての設定と実際に投入された（投入されてなくても、dbt がデフォルトで設定したものも含めた）値が dbt Artifacts に書かれている。。。

# dbt Artifacts

dbt Artifacts とは、以下の５つの JSON ファイルが中心となっているようです。

| ファイル名 | 生成タイミング |
|----|----|
| [semantic_manifest.json](https://docs.getdbt.com/reference/artifacts/sl-manifest) | dbt プロジェクトの解析 |
| [manifest.json](https://docs.getdbt.com/reference/artifacts/manifest-json) | プロジェクトを読み込んで理解するコマンドの実行 |
| [run_results.json](https://docs.getdbt.com/reference/artifacts/run-results-json) | DAG 内のノードを実行、コンパイル、カタログ化するコマンドの実行 |
| [catalog.json](https://docs.getdbt.com/reference/artifacts/catalog-json) | docs generate コマンドの実行 |
| [sources.json](https://docs.getdbt.com/reference/artifacts/sources-json) | source freshness コマンドの実行 |

その他は、[こちら](https://docs.getdbt.com/reference/artifacts/other-artifacts)を参照ください。

このうち、manifest.json の説明を引用すると、

> This single file contains a full representation of your dbt project's resources (models, tests, macros, etc), including all node configurations and resource properties. 

> この単一のファイルには、すべてのノード構成とリソース プロパティを含む、dbt プロジェクトのリソース (モデル、テスト、マクロなど) の完全な表現が含まれています。

ということで、こちらを深堀りしたいと思います。[JSON スキーマ](https://schemas.getdbt.com/)もあるので、[v12](https://schemas.getdbt.com/dbt/manifest/v12/index.html) の JSON スキーマを正とします。

## manifest.json（WritableManifest）

トップレベルの root オブジェクトになります。

以下、同様に末端まで調べていくと、完成した一覧が dbt に与えられる入出力の全体像になるというのが目論見です。説明は、できるだけドキュメントやソースのあるものにして、見つけられなかったものは、空欄にしておきます。

項目は、JSON スキーマ、型は、対応する Python コード、説明は、ドキュメントサイト（なければ Python コード）をベースにします。

| 項目 | 型 | 説明 |
|----|----|----|
| metadata | [ManifestMetadata](#manifestmetadata) | [Common metadata](https://docs.getdbt.com/reference/artifacts/dbt-artifacts#common-metadata) |
| nodes | Mapping[UniqueID, [ManifestResource](#manifestresource)] | Dictionary of all [analyses](#analysis), [models](#model), [seeds](#seed), snapshots, and [tests](#singulartest). |
| sources | Mapping[UniqueID, SourceDefinition] | Dictionary of sources. |
| macros | Mapping[UniqueID, Macro] | Dictionary of macros. |
| docs | Mapping[UniqueID, Documentation] | Dictionary of docs blocks. |
| exposures | Mapping[UniqueID, Exposure]  | Dictionary of exposures. |
| metrics | Mapping[UniqueID, Metric] | Dictionary of metrics. |
| groups | Mapping[UniqueID, Group] | Dictionary of groups. |
| selectors | Mapping[UniqueID, Any] | Expanded dictionary representation of YAML selectors. |
| disabled | Optional[Mapping[UniqueID, List[DisabledManifestResource]]] | Array of resources with enabled: false. |
| parent_map | Optional[NodeEdgeMap] | Dictionary that contains the first-order parents of each resource. |
| child_map | Optional[NodeEdgeMap] | Dictionary that contains the first-order children of each resource. |
| group_map | Optional[NodeEdgeMap] | Dictionary that maps group names to their resource nodes. |
| saved_queries | Mapping[UniqueID, SavedQuery] | The saved queries defined in the dbt project |
| semantic_models | Mapping[UniqueID, SemanticModel] | The semantic models defined in the dbt project |
| unit_tests | Mapping[UniqueID, UnitTestDefinition] | The unit tests defined in the project |

## ManifestMetadata

ここから先、対応する Python コードは継承を使用していますが、継承は無視してフラットに展開します。（失礼ですが、共通化重視の継承でスパゲティ化しているため。is-a 関係が壊れているアンチパターン）

| 項目 | 型 | 説明 |
|----|----|----|
| dbt_schema_version | str | URL of this artifact's schema. |
| dbt_version | str | Version of dbt that produced this artifact. |
| generated_at | str | Timestamp in UTC when this artifact was produced. |
| invocation_id | Optional[str] | Unique identifier for this dbt invocation |
| invocation_started_at | Optional[datetime] |  |
| env | Dict[str, str] | Any environment variables prefixed with DBT_ENV_CUSTOM_ENV_ will be included in a dictionary, with the prefix-stripped variable name as its key. |
| project_name | Optional[str] | The name defined in the root project's dbt_project.yml |
| project_id | Optional[str] | Project identifier, hashed from project_name, sent with anonymous usage stats if enabled. |
| user_id | Optional[UUID] | User identifier, stored by default in ~/dbt/.user.yml, sent with anonymous usage stats if enabled. |
| send_anonymous_usage_stats | Optional[bool] | Whether this invocation sent anonymous usage statistics while executing. |
| adapter_type | Optional[str] | The adapter (database), e.g. postgres, spark, etc. |

## ManifestResource

ここは、node の枝でサブタイプに分岐します。

### Seed

このオブジェクトの継承階層は、`->ParsedResource->ParsedResourceMandatory->GraphResource, HasRelationMetadata` です。

| 項目 | 型 | 説明 |
|----|----|----|
| database | Optional[str] | Configure a database in your dbt_project.yml file. |
| schema | str | The schema name as stored in the database. |
| name | str | Resource name. |
| resource_type | Literal[NodeType.Seed] |  |
| package_name | str | Name of package that defines this resource. |
| path | str | Relative file path of this resource's definition within its "resource path" |
| original_file_path | str | Relative file path of this resource's definition, including its resource path. |
| unique_id | str | <resource_type>.<package>.<resource_name>, same as dictionary key |
| fqn | List[str] |  |
| alias | str |  |
| checksum | FileHash |  |
| config | SeedConfig |  |
| tags | List[str] |  |
| description | str |  |
| columns | Dict[str, ColumnInfo] |  |
| meta | Dict[str, Any] |  |
| group | Optional[str] |  |
| docs | Docs |  |
| patch_path | Optional[str] |  |
| build_path | Optional[str] |  |
| unrendered_config | Dict[str, Any] |  |
| created_at | float |  |
| config_call_dict | Dict[str, Any] |  |
| unrendered_config_call_dict | Dict[str, Any] |  |
| relation_name | Optional[str] |  |
| raw_code | str |  |
| doc_blocks | List[str] |  |
| root_path | Optional[str]  | Absolute file path of this resource's package.  |
| depends_on | MacroDependsOn |  |
| defer_relation | Optional[DeferRelation] |  |

### Analysis

このオブジェクトの継承階層は、`->CompiledResource->ParsedResource` （以下同文）

| 項目 | 型 | 説明 |
|----|----|----|
| database | Optional[str] | Configure a database in your dbt_project.yml file. |
| schema | str | The schema name as stored in the database. |
| name | str | Resource name. |
| resource_type | Literal[NodeType.Analysis] |  |
| package_name | str | Name of package that defines this resource. |
| path | str | Relative file path of this resource's definition within its "resource path" |
| original_file_path | str | Relative file path of this resource's definition, including its resource path. |
| unique_id | str | <resource_type>.<package>.<resource_name>, same as dictionary key |
| fqn | List[str] |  |
| alias | str |  |
| checksum | FileHash |  |
| config | NodeConfig |  |
| tags | List[str] |  |
| description | str |  |
| columns | Dict[str, ColumnInfo] |  |
| meta | Dict[str, Any] |  |
| group | Optional[str] |  |
| docs | Docs |  |
| patch_path | Optional[str] |  |
| build_path | Optional[str] |  |
| unrendered_config | Dict[str, Any] |  |
| created_at | float |  |
| config_call_dict | Dict[str, Any] |  |
| unrendered_config_call_dict | Dict[str, Any] |  |
| relation_name | Optional[str] |  |
| raw_code | str |  |
| doc_blocks | List[str] |  |
| language | str |  |
| refs | List[RefArgs] |  |
| sources | List[List[str]] |  |
| metrics | List[List[str]] |  |
| depends_on | DependsOn |  |
| compiled_path | Optional[str] |  |
| compiled | bool |  |
| compiled_code | Optional[str] |  |
| extra_ctes_injected | bool |  |
| extra_ctes | List[InjectedCTE] |  |
| _pre_injected_sql | Optional[str] |  |
| contract | Contract |  |

### SingularTest

このオブジェクトの継承階層は、`->CompiledResource` （以下同文かつ resource_type と config 以外は、[Analysis](#analysis) と同じ）

| 項目 | 型 | 説明 |
|----|----|----|
| database | Optional[str] | Configure a database in your dbt_project.yml file. |
| schema | str | The schema name as stored in the database. |
| name | str | Resource name. |
| resource_type | Literal[NodeType.Test] |  |
| package_name | str | Name of package that defines this resource. |
| path | str | Relative file path of this resource's definition within its "resource path" |
| original_file_path | str | Relative file path of this resource's definition, including its resource path. |
| unique_id | str | <resource_type>.<package>.<resource_name>, same as dictionary key |
| fqn | List[str] |  |
| alias | str |  |
| checksum | FileHash |  |
| config | TestConfig |  |
| tags | List[str] |  |
| description | str |  |
| columns | Dict[str, ColumnInfo] |  |
| meta | Dict[str, Any] |  |
| group | Optional[str] |  |
| docs | Docs |  |
| patch_path | Optional[str] |  |
| build_path | Optional[str] |  |
| unrendered_config | Dict[str, Any] |  |
| created_at | float |  |
| config_call_dict | Dict[str, Any] |  |
| unrendered_config_call_dict | Dict[str, Any] |  |
| relation_name | Optional[str] |  |
| raw_code | str |  |
| doc_blocks | List[str] |  |
| language | str |  |
| refs | List[RefArgs] |  |
| sources | List[List[str]] |  |
| metrics | List[List[str]] |  |
| depends_on | DependsOn |  |
| compiled_path | Optional[str] |  |
| compiled | bool |  |
| compiled_code | Optional[str] |  |
| extra_ctes_injected | bool |  |
| extra_ctes | List[InjectedCTE] |  |
| _pre_injected_sql | Optional[str] |  |
| contract | Contract |  |

### HookNode（Operation）

このオブジェクトの継承階層は、`->CompiledResource` （以下同文かつ resource_type と index 以外は、[Analysis](#analysis) と同じ）

| 項目 | 型 | 説明 |
|----|----|----|
| database | Optional[str] | Configure a database in your dbt_project.yml file. |
| schema | str | The schema name as stored in the database. |
| name | str | Resource name. |
| resource_type | Literal[NodeType.Operation] |  |
| package_name | str | Name of package that defines this resource. |
| path | str | Relative file path of this resource's definition within its "resource path" |
| original_file_path | str | Relative file path of this resource's definition, including its resource path. |
| unique_id | str | <resource_type>.<package>.<resource_name>, same as dictionary key |
| fqn | List[str] |  |
| alias | str |  |
| checksum | FileHash |  |
| config | NodeConfig |  |
| tags | List[str] |  |
| description | str |  |
| columns | Dict[str, ColumnInfo] |  |
| meta | Dict[str, Any] |  |
| group | Optional[str] |  |
| docs | Docs |  |
| patch_path | Optional[str] |  |
| build_path | Optional[str] |  |
| unrendered_config | Dict[str, Any] |  |
| created_at | float |  |
| config_call_dict | Dict[str, Any] |  |
| unrendered_config_call_dict | Dict[str, Any] |  |
| relation_name | Optional[str] |  |
| raw_code | str |  |
| doc_blocks | List[str] |  |
| language | str |  |
| refs | List[RefArgs] |  |
| sources | List[List[str]] |  |
| metrics | List[List[str]] |  |
| depends_on | DependsOn |  |
| compiled_path | Optional[str] |  |
| compiled | bool |  |
| compiled_code | Optional[str] |  |
| extra_ctes_injected | bool |  |
| extra_ctes | List[InjectedCTE] |  |
| _pre_injected_sql | Optional[str] |  |
| contract | Contract |  |
| index | Optional[int] |  |

### Model

このオブジェクトの継承階層は、`->CompiledResource` （ここは独自項目が末尾にいくつかあります）

| 項目 | 型 | 説明 |
|----|----|----|
| database | Optional[str] | Configure a database in your dbt_project.yml file. |
| schema | str | The schema name as stored in the database. |
| name | str | Resource name. |
| resource_type | Literal[NodeType.Model] |  |
| package_name | str | Name of package that defines this resource. |
| path | str | Relative file path of this resource's definition within its "resource path" |
| original_file_path | str | Relative file path of this resource's definition, including its resource path. |
| unique_id | str | <resource_type>.<package>.<resource_name>, same as dictionary key |
| fqn | List[str] |  |
| alias | str |  |
| checksum | FileHash |  |
| config | ModelConfig |  |
| tags | List[str] |  |
| description | str |  |
| columns | Dict[str, ColumnInfo] |  |
| meta | Dict[str, Any] |  |
| group | Optional[str] |  |
| docs | Docs |  |
| patch_path | Optional[str] |  |
| build_path | Optional[str] |  |
| unrendered_config | Dict[str, Any] |  |
| created_at | float |  |
| config_call_dict | Dict[str, Any] |  |
| unrendered_config_call_dict | Dict[str, Any] |  |
| relation_name | Optional[str] |  |
| raw_code | str |  |
| doc_blocks | List[str] |  |
| language | str |  |
| refs | List[RefArgs] |  |
| sources | List[List[str]] |  |
| metrics | List[List[str]] |  |
| depends_on | DependsOn |  |
| compiled_path | Optional[str] |  |
| compiled | bool |  |
| compiled_code | Optional[str] |  |
| extra_ctes_injected | bool |  |
| extra_ctes | List[InjectedCTE] |  |
| _pre_injected_sql | Optional[str] |  |
| contract | Contract |  |
| access | AccessType |  |
| constraints | List[ModelLevelConstraint] |  |
| version | Optional[NodeVersion] |  |
| latest_version | Optional[NodeVersion] |  |
| deprecation_date | Optional[datetime] |  |
| defer_relation | Optional[DeferRelation] |  |
| primary_key | List[str] |  |
| time_spine | Optional[TimeSpine] |  |
| freshness | Optional[ModelFreshness] |  |

### SqlOperation

このオブジェクトの継承階層は、`->CompiledResource` （以下同文かつ resource_type 以外は、[Analysis](#analysis) と同じ）

| 項目 | 型 | 説明 |
|----|----|----|
| database | Optional[str] | Configure a database in your dbt_project.yml file. |
| schema | str | The schema name as stored in the database. |
| name | str | Resource name. |
| resource_type | Literal[NodeType.SqlOperation] |  |
| package_name | str | Name of package that defines this resource. |
| path | str | Relative file path of this resource's definition within its "resource path" |
| original_file_path | str | Relative file path of this resource's definition, including its resource path. |
| unique_id | str | <resource_type>.<package>.<resource_name>, same as dictionary key |
| fqn | List[str] |  |
| alias | str |  |
| checksum | FileHash |  |
| config | NodeConfig |  |
| tags | List[str] |  |
| description | str |  |
| columns | Dict[str, ColumnInfo] |  |
| meta | Dict[str, Any] |  |
| group | Optional[str] |  |
| docs | Docs |  |
| patch_path | Optional[str] |  |
| build_path | Optional[str] |  |
| unrendered_config | Dict[str, Any] |  |
| created_at | float |  |
| config_call_dict | Dict[str, Any] |  |
| unrendered_config_call_dict | Dict[str, Any] |  |
| relation_name | Optional[str] |  |
| raw_code | str |  |
| doc_blocks | List[str] |  |
| language | str |  |
| refs | List[RefArgs] |  |
| sources | List[List[str]] |  |
| metrics | List[List[str]] |  |
| depends_on | DependsOn |  |
| compiled_path | Optional[str] |  |
| compiled | bool |  |
| compiled_code | Optional[str] |  |
| extra_ctes_injected | bool |  |
| extra_ctes | List[InjectedCTE] |  |
| _pre_injected_sql | Optional[str] |  |
| contract | Contract |  |

### GenericTest

このオブジェクトの継承階層は、`->CompiledResource` （ここは独自項目が末尾にいくつかあります）

| 項目 | 型 | 説明 |
|----|----|----|
| database | Optional[str] | Configure a database in your dbt_project.yml file. |
| schema | str | The schema name as stored in the database. |
| name | str | Resource name. |
| resource_type | Literal[NodeType.Test] |  |
| package_name | str | Name of package that defines this resource. |
| path | str | Relative file path of this resource's definition within its "resource path" |
| original_file_path | str | Relative file path of this resource's definition, including its resource path. |
| unique_id | str | <resource_type>.<package>.<resource_name>, same as dictionary key |
| fqn | List[str] |  |
| alias | str |  |
| checksum | FileHash |  |
| config | TestConfig |  |
| tags | List[str] |  |
| description | str |  |
| columns | Dict[str, ColumnInfo] |  |
| meta | Dict[str, Any] |  |
| group | Optional[str] |  |
| docs | Docs |  |
| patch_path | Optional[str] |  |
| build_path | Optional[str] |  |
| unrendered_config | Dict[str, Any] |  |
| created_at | float |  |
| config_call_dict | Dict[str, Any] |  |
| unrendered_config_call_dict | Dict[str, Any] |  |
| relation_name | Optional[str] |  |
| raw_code | str |  |
| doc_blocks | List[str] |  |
| language | str |  |
| refs | List[RefArgs] |  |
| sources | List[List[str]] |  |
| metrics | List[List[str]] |  |
| depends_on | DependsOn |  |
| compiled_path | Optional[str] |  |
| compiled | bool |  |
| compiled_code | Optional[str] |  |
| extra_ctes_injected | bool |  |
| extra_ctes | List[InjectedCTE] |  |
| _pre_injected_sql | Optional[str] |  |
| contract | Contract |  |
| column_name | Optional[str] |  |
| file_key_name | Optional[str] |  |
| attached_node | Optional[str] |  |
| test_metadata | TestMetadata |  |

### 

# おわりに

| 項目 | 型 | 説明 |
|----|----|----|
|  |  |  |
