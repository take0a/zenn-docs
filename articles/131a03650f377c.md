---
title: "dltã®ä»•çµ„ã¿"
emoji: "ğŸ”—"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["python", "dlt", "uv", "duckdb"]
published: true
publication_name: "robon"
---

# ã¯ã˜ã‚ã«
ä½•ã‹æœˆã‹å‰ã«ã€[dltå…¥é–€](https://zenn.dev/robon/articles/b82a94295e8fae) ã¨é¡Œã—ã¦ã€dlt ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’ãªãã‚‹ã‚ˆã†ãªè¨˜äº‹ã‚’æ›¸ãã¾ã—ãŸã€‚
dlt ãŒã€ELT ã® E ã¨ L ã‚’ã‚„ã£ã¦ãã‚Œã‚‹ã®ã¯ã€ã‚ã‹ã£ãŸã®ã§ã™ãŒã€ã‚ã¾ã‚Šã«ã‚‚å°‘ãªã„è¡Œæ•°ã§ã‚³ãƒ”ãƒ¼ã§ãã¦ã—ã¾ã£ãŸã®ã§ã€Œã§ã€ã©ã†ãªã£ã¦ã‚‹ã®ï¼Ÿã€ã‚’èª¿ã¹ã¦ã¿ã‚ˆã†ã¨ã„ã†è¨˜äº‹ã§ã™ã€‚

# ã‚„ã£ã¦ã¿ã‚‹
## å¾©ç¿’
ã¾ãšã¯ã€å‰å›ã®å¾©ç¿’ã‹ã‚‰ã€‚ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã®ã¨ãŠã‚Šã«ã‚„ã‚‹ã¨ã€CLI ãŒ init ã§ãƒ¢ãƒªãƒ¢ãƒªæ›¸ã„ã¦ãã‚ŒãŸã‚³ãƒ¼ãƒ‰ã‚‚ã‚ã‚‹ã®ã§ã€ãƒãƒƒã‚µãƒªå‰Šé™¤ã—ã¦ã¿ã¾ã™ã€‚

### REST API
ä»¥ä¸‹ã®ã¨ãŠã‚Šã€30è¡Œã¡ã‚‡ã„ã§ã™ã€‚

```py: rest-api/rest_api_pipeline.py
import dlt
from dlt.sources.rest_api import rest_api_source


pokemon_source = rest_api_source(
    {
        "client": {
            "base_url": "https://pokeapi.co/api/v2/",
        },
        "resource_defaults": {
            "endpoint": {
                "params": {
                    "limit": 1000,
                },
            },
        },
        "resources": [
            "pokemon",
            "berry",
            "location",
        ],
    }
)

pipeline = dlt.pipeline(
    pipeline_name="rest_api_pokemon",
    destination="duckdb",
    dataset_name="rest_api_data",
)

load_info = pipeline.run(pokemon_source)
print(load_info)
```

### SQL DB
ã“ã£ã¡ã¯ã€10è¡Œã¡ã‚‡ã„ã§ã™ã€‚

```py: sql-database/sql_database_pipeline.py
import dlt
from dlt.sources.sql_database import sql_database


source = sql_database().with_resources("family", "genome")

pipeline = dlt.pipeline(
    pipeline_name="sql_to_duckdb_pipeline",
    destination="duckdb",
    dataset_name="sql_to_duckdb_pipeline_data",
)

load_info = pipeline.run(source)
print(load_info)
```

ã‚ã¨ã€DB ã¸ã®æ¥ç¶šæƒ…å ±ãŒå¿…è¦ã§ã™ã€‚

```toml: sql-database/.dlt/secret.toml
[sources.sql_database.credentials]
drivername = "mysql+pymysql" # database+dialect
database = "Rfam"
password = ""
username = "rfamro"
host = "mysql-rfam-public.ebi.ac.uk"
port = 4497
```

### File System
ã“ã‚Œã‚‚ 10è¡Œã¡ã‚‡ã„ã€‚

```py: file-system/filesystem_pipeline.py
import dlt
from dlt.sources.filesystem import filesystem, read_csv


files = filesystem(bucket_url="gs://filesystem-tutorial", file_glob="encounters*.csv")
reader = (files | read_csv()).with_name("encounters")

pipeline = dlt.pipeline(
    pipeline_name="hospital_data_pipeline",
    destination="duckdb",
    dataset_name="hospital_data",
)

info = pipeline.run(reader)
print(info)
```

è¨­å®šæƒ…å ±ã¯ã€ä»¥ä¸‹ã®ï¼’ã¤

```toml: file-system/.dlt/config.toml
[sources.readers.filesystem]
bucket_url="gs://filesystem-tutorial"
```
```toml: file-system/.dlt/secret.toml
[sources.readers.filesystem.credentials]
client_email = "public-access@dlthub-sandbox.iam.gserviceaccount.com"
project_id = "dlthub-sandbox"
private_key = "-----BEGIN PRIVATE KEY-----\nMIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSiAgEAAoIBAQDGWsVHJRjliojx\nTo+j1qu+x8PzC5ZHZrMx6e8OD6tO8uxMyl65ByW/4FZkVXkS4SF/UYPigGN+rel4\nFmySTbP9orva4t3Pk1B9YSvQMB7V5IktmTIW9Wmdmn5Al8Owb1RehgIidm1EX/Z9\nLr09oLpO6+jUu9RIP2Lf2mVQ6tvkgl7UOdpdGACSNGzRiZgVZDOaDIgH0Tl4UWmK\n6iPxhwZy9YC2B1beLB/NU+F6DUykrEpBzCFQTqFoTUcuDAEvuvpU9JrU2iBMiOGw\nuP3TYSiudhBjmauEUWaMiqWAgFeX5ft1vc7/QWLdI//SAjaiTAu6pTer29Q0b6/5\niGh0jRXpAgMBAAECggEAL8G9C9MXunRvYkH6/YR7F1T7jbH1fb1xWYwsXWNSaJC+\nagKzabMZ2KfHxSJ7IxuHOCNFMKyex+pRcvNbMqJ4upGKzzmeFBMw5u8VYGulkPQU\nPyFKWRK/Wg3PZffkSr+TPargKrH+vt6n9x3gvEzNbqEIDugmRTrVsHXhvOi/BrYc\nWhppHSVQidWZi5KVwDEPJjDQiHEcYI/vfIy1WhZ8VuPAaE5nMZ1m7gTdeaWWKIAj\n/p2ZkLgRdCY8vNkfaNDAxDbvH+CMuTtOw55GydzsYYiofANS6xZ8CedGkYaGi82f\nqGdLghX61Sg3UAb5SI36T/9XbuCpTf3B/SMV20ew8QKBgQDm2yUxL71UqI/xK9LS\nHWnqfHpKmHZ+U9yLvp3v79tM8XueSRKBTJJ4H+UvVQrXlypT7cUEE+sGpTrCcDGL\nm8irtdUmMvdi7AnRBgmWdYKig/kgajLOUrjXqFt/BcFgqMyTfzqPt3xdp6F3rSEK\nHE6PQ8I3pJ0BJOSJRa6Iw2VH1QKBgQDb9WbVFjYwTIKJOV4J2plTK581H8PI9FSt\nUASXcoMTixybegk8beGdwfm2TkyF/UMzCvHfuaUhf+S0GS5Zk31Wkmh1YbmFU4Q9\nm9K/3eoaqF7CohpigB0wJw4HfqNh6Qt+nICOMCv++gw7+/UwfV72dCqr0lpzfX5F\nAsez8igTxQKBgDsq/axOnQr+rO3WGpGJwmS8BKfrzarxGXyjnV0qr51X4yQdfGWx\nV3T8T8RC2qWI8+tQ7IbwB/PLE3VURg6PHe6MixXgSDGNZ7KwBnMOqS23/3kEXwMs\nhn2Xg+PZeMeqW8yN9ldxYqmqViMTN32c5bGoXzXdtfPeHcjlGCerVOEFAoGADVPi\nRjkRUX3hTvVF6Gzxa2OyQuLI1y1O0C2QCakrngyI0Dblxl6WFBwDyHMYGepNnxMj\nsr2p7sy0C+GWuGDCcHNwluQz/Ish8SW28F8+5xyamUp/NMa0fg1vwS6AMdeQFbzf\n4T2z/MAj66KJqcV+8on5Z+3YAzVwaDgR56pdmU0CgYBo2KWcNWAhZ1Qa6sNrITLV\nGlxg6tWP3OredZrmKb1kj5Tk0V+EwVN+HnKzMalv6yyyK7SWq1Z6rvCye37vy27q\nD7xfuz0c0H+48uWJpdLcsxpTioopsRPayiVDKlHSe/Qa+MEjAG3ded5TJiC+5iSw\nxWJ51y0wpme0LWgzzoLbRw==\n-----END PRIVATE KEY-----\n"
```

è¦ã™ã‚‹ã«ã€`pipeline.run()` ã« dlt ç”¨èªã§è¨€ã†ã¨ã“ã‚ã® [Source](https://dlthub.com/docs/devel/general-usage/source) ã‚’æ¸¡ã—ã¦ãŠã—ã¾ã„ã€‚

ã¾ãã€é»’é­”è¡“çš„ãªä½•ã‹ï¼ˆç¬‘ï¼‰ã§ã‚ã‚‹ `pipeline.run()` ã®ä¸­ã®æ§‹é€ ã¨ãã‚Œãã‚Œã®ç®‡æ‰€ã§ä½•ã‚’ã‚„ã£ã¦ã„ã‚‹ã‹è¦‹ã¦ã„ãã¾ã™ã€‚

## ã©ã†ãªã£ã¦ã‚‹ã®ï¼Ÿ

[ä¸Šè¨˜ã® REST API](#rest-api) ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®æœ€çµ‚è¡Œ `print(load_info)` ã«ã‚ˆã£ã¦ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå‡ºåŠ›ãŒå¾—ã‚‰ã‚Œã¾ã™ã€‚

```sh
$ uv run rest_api_pipeline.py 
2025-07-08 02:20:03,926|[WARNING]|13043|139762141091648|dlt|client.py|detect_paginator:312|Fallback paginator used: SinglePagePaginator at 7f1cbfca83b0. Please provide right paginator manually.
Pipeline rest_api_pokemon load step completed in 0.19 seconds
1 load package(s) were loaded to destination duckdb and into dataset rest_api_data
The duckdb destination used duckdb:////home/ec2-user/work/mds/dlt-getting-started/rest-api/rest_api_pokemon.duckdb location to store data
Load package 1751941203.521931 is LOADED and contains no failed jobs
```

ã“ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã® [Destination](https://dlthub.com/docs/devel/general-usage/destination) ã§ã‚ã‚‹ `rest_api_pokemon.duckdb` ã‚’èª¿ã¹ã¦ã¿ã¾ã™ã€‚

```sh
$ ~/.duckdb/cli/latest/duckdb rest_api_pokemon.duckdb
v1.2.1 8e52ec4395
Enter ".help" for usage hints.
D .tables
_dlt_loads           _dlt_version         location           
_dlt_pipeline_state  berry                pokemon            
D .schema pokemon
CREATE TABLE rest_api_data.pokemon("name" VARCHAR, url VARCHAR, _dlt_load_id VARCHAR NOT NULL, _dlt_id VARCHAR NOT NULL);
D .maxrows 10
D select * from rest_api_data.pokemon;
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         name         â”‚                   url                    â”‚   _dlt_load_id    â”‚    _dlt_id     â”‚
â”‚       varchar        â”‚                 varchar                  â”‚      varchar      â”‚    varchar     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ bulbasaur            â”‚ https://pokeapi.co/api/v2/pokemon/1/     â”‚ 1751941203.521931 â”‚ rRaJzqYDYOQKzw â”‚
â”‚ ivysaur              â”‚ https://pokeapi.co/api/v2/pokemon/2/     â”‚ 1751941203.521931 â”‚ f+4TykRTqpvGow â”‚
â”‚ venusaur             â”‚ https://pokeapi.co/api/v2/pokemon/3/     â”‚ 1751941203.521931 â”‚ jLaaVsbYDZ2RKg â”‚
â”‚ charmander           â”‚ https://pokeapi.co/api/v2/pokemon/4/     â”‚ 1751941203.521931 â”‚ l63T6AFiyzV1Mw â”‚
â”‚ charmeleon           â”‚ https://pokeapi.co/api/v2/pokemon/5/     â”‚ 1751941203.521931 â”‚ H6cElA2854FO/A â”‚
â”‚     Â·                â”‚                  Â·                       â”‚         Â·         â”‚       Â·        â”‚
â”‚     Â·                â”‚                  Â·                       â”‚         Â·         â”‚       Â·        â”‚
â”‚     Â·                â”‚                  Â·                       â”‚         Â·         â”‚       Â·        â”‚
â”‚ ogerpon-wellspringâ€¦  â”‚ https://pokeapi.co/api/v2/pokemon/10273/ â”‚ 1751941203.521931 â”‚ 3ngMzqxa7i1/vA â”‚
â”‚ ogerpon-hearthflamâ€¦  â”‚ https://pokeapi.co/api/v2/pokemon/10274/ â”‚ 1751941203.521931 â”‚ wEsxg2ZxkTOgHg â”‚
â”‚ ogerpon-cornerstonâ€¦  â”‚ https://pokeapi.co/api/v2/pokemon/10275/ â”‚ 1751941203.521931 â”‚ GAB25+W8YF47cg â”‚
â”‚ terapagos-terastal   â”‚ https://pokeapi.co/api/v2/pokemon/10276/ â”‚ 1751941203.521931 â”‚ 9Eu4tjzcesxQCQ â”‚
â”‚ terapagos-stellar    â”‚ https://pokeapi.co/api/v2/pokemon/10277/ â”‚ 1751941203.521931 â”‚ v/g6/OOE1W5xLg â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1302 rows (10 shown)                                                                       4 columns â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
D .quit
```

### Pipeline ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª

ã‚„ã£ã±ã‚Šã€ã‚ˆãã‚ã‹ã‚Šã¾ã›ã‚“ã€‚åˆ¥ã«éš ã—ã¦ã„ã‚‹ã‚ã‘ã§ã¯ãªã„ã®ã§ã—ã‚‡ã†ãŒã€[Pipeline working directory](https://dlthub.com/docs/general-usage/pipeline#pipeline-working-directory) ã¨ã„ã†ã®ãŒã‚ã£ã¦ã€ã“ã‚Œã¨ã‚»ãƒƒãƒˆã§è€ƒãˆãªã„ã¨ã€ã‚¹ã‚­ãƒ¼ãƒã®æ¨å®šã ã£ãŸã‚Šã€é€²åŒ–ã ã£ãŸã‚ŠãŒã§ãã¡ã‚ƒã†ã®ã¯ã€æ„å‘³ãŒã‚ã‹ã‚‰ãªã„ã§ã™ã€‚

ã¨ã„ã†ã“ã¨ã§ã€è¦‹ã¦ã¿ã¾ã™ã€‚

```sh
$ tree -a ~/.dlt
/home/ec2-user/.dlt
â”œâ”€â”€ .anonymous_id
â””â”€â”€ pipelines
    â””â”€â”€ rest_api_pokemon
        â”œâ”€â”€ load
        â”‚   â”œâ”€â”€ .version
        â”‚   â”œâ”€â”€ loaded
        â”‚   â”‚   â””â”€â”€ 1751941203.521931
        â”‚   â”‚       â”œâ”€â”€ applied_schema_updates.json
        â”‚   â”‚       â”œâ”€â”€ completed_jobs
        â”‚   â”‚       â”‚   â”œâ”€â”€ _dlt_pipeline_state.01049b38d0.0.insert_values
        â”‚   â”‚       â”‚   â”œâ”€â”€ berry.fcc100835e.0.insert_values
        â”‚   â”‚       â”‚   â”œâ”€â”€ location.c617abb58e.0.insert_values
        â”‚   â”‚       â”‚   â””â”€â”€ pokemon.4c44034d94.0.insert_values
        â”‚   â”‚       â”œâ”€â”€ failed_jobs
        â”‚   â”‚       â”œâ”€â”€ load_package_state.json
        â”‚   â”‚       â”œâ”€â”€ new_jobs
        â”‚   â”‚       â”œâ”€â”€ package_completed.json
        â”‚   â”‚       â”œâ”€â”€ schema.json
        â”‚   â”‚       â””â”€â”€ started_jobs
        â”‚   â”œâ”€â”€ new
        â”‚   â””â”€â”€ normalized
        â”œâ”€â”€ normalize
        â”‚   â”œâ”€â”€ .version
        â”‚   â””â”€â”€ extracted
        â”œâ”€â”€ schemas
        â”‚   â””â”€â”€ rest_api.schema.json
        â”œâ”€â”€ state.json
        â””â”€â”€ trace.pickle

14 directories, 14 files
```

ã¾ã€ç›´æ„Ÿçš„ã« `normalize/extracted` -> `load/normalized` -> `load/loaded` ãªã‚“ã§ã—ã‚‡ã†ã­ã€‚

èª­ã‚ãã†ãªãƒ¤ãƒ„ã‹ã‚‰ã€è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚ä»¥ä¸‹ã€`~/.dlt/pipeline/rest_api_pokemon/` é…ä¸‹ã§ã™ã€‚ã‚ã¨ã€äººé–“ç”¨ã«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã—ã¦ã‚ã‚Šã¾ã™ã€‚

```json: state.json
{
    "_state_version": 1,
    "_state_engine_version": 4,
    "_local": {
        "first_run": false,
        "initial_cwd": "/home/ec2-user/work/mds/dlt-getting-started/rest-api",
        "_last_extracted_at": "ï€§2025-07-08T02:20:05.457912+00:00",
        "_last_extracted_hash": "+wss72MdiSWsH7g47UzNMXD/ImQwLpGyJGjr/Honm0k="
    },
    "default_schema_name": "rest_api",
    "pipeline_name": "rest_api_pokemon",
    "dataset_name": "rest_api_data",
    "schema_names": [
        "rest_api"
    ],
    "destination_type": "dlt.destinations.duckdb",
    "destination_name": null,
    "_version_hash": "+wss72MdiSWsH7g47UzNMXD/ImQwLpGyJGjr/Honm0k="
}
```

å‰å›å®Ÿè¡Œæ™‚ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã€åå‰ã€ãƒ‘ã‚¹ã€æ™‚åˆ»ãªã©ãŒã‚ã‚Šã¾ã™ã®ã§ã€ä»Šå›ã€ç’°å¢ƒãŒå¤‰ã‚ã£ãŸã‚Šã—ã¦ã‚‚åˆ¤å®šã§ããã†ã§ã™ã€‚

```json: schemas/rest_api.schema.json
{
  "version": 2,
  "version_hash": "bjSDsQVwCCxpVbi/s/7nk6E1Ezg9g65MV87tUMMvA8k=",
  "engine_version": 11,
  "name": "rest_api",
  "tables": {
    "_dlt_version": {
      "name": "_dlt_version",
      "columns": {
        "version": {
          "name": "version",
          "data_type": "bigint",
          "nullable": false
        },
        "engine_version": {
          "name": "engine_version",
          "data_type": "bigint",
          "nullable": false
        },
        "inserted_at": {
          "name": "inserted_at",
          "data_type": "timestamp",
          "nullable": false
        },
        "schema_name": {
          "name": "schema_name",
          "data_type": "text",
          "nullable": false
        },
        "version_hash": {
          "name": "version_hash",
          "data_type": "text",
          "nullable": false
        },
        "schema": {
          "name": "schema",
          "data_type": "text",
          "nullable": false
        }
      },
      "write_disposition": "skip",
      "resource": "_dlt_version",
      "description": "Created by DLT. Tracks schema updates"
    },
    "_dlt_loads": {
      "name": "_dlt_loads",
      "columns": {
        "load_id": {
          "name": "load_id",
          "data_type": "text",
          "nullable": false
        },
        "schema_name": {
          "name": "schema_name",
          "data_type": "text",
          "nullable": true
        },
        "status": {
          "name": "status",
          "data_type": "bigint",
          "nullable": false
        },
        "inserted_at": {
          "name": "inserted_at",
          "data_type": "timestamp",
          "nullable": false
        },
        "schema_version_hash": {
          "name": "schema_version_hash",
          "data_type": "text",
          "nullable": true
        }
      },
      "write_disposition": "skip",
      "resource": "_dlt_loads",
      "description": "Created by DLT. Tracks completed loads"
    },
    "pokemon": {
      "columns": {
        "name": {
          "name": "name",
          "data_type": "text",
          "nullable": true
        },
        "url": {
          "name": "url",
          "data_type": "text",
          "nullable": true
        },
        "_dlt_load_id": {
          "name": "_dlt_load_id",
          "data_type": "text",
          "nullable": false
        },
        "_dlt_id": {
          "name": "_dlt_id",
          "data_type": "text",
          "nullable": false,
          "unique": true,
          "row_key": true
        }
      },
      "write_disposition": "append",
      "name": "pokemon",
      "resource": "pokemon",
      "x-normalizer": {
        "seen-data": true
      }
    },
    "berry": {
      "columns": {
        "name": {
          "name": "name",
          "data_type": "text",
          "nullable": true
        },
        "url": {
          "name": "url",
          "data_type": "text",
          "nullable": true
        },
        "_dlt_load_id": {
          "name": "_dlt_load_id",
          "data_type": "text",
          "nullable": false
        },
        "_dlt_id": {
          "name": "_dlt_id",
          "data_type": "text",
          "nullable": false,
          "unique": true,
          "row_key": true
        }
      },
      "write_disposition": "append",
      "name": "berry",
      "resource": "berry",
      "x-normalizer": {
        "seen-data": true
      }
    },
    "location": {
      "columns": {
        "name": {
          "name": "name",
          "data_type": "text",
          "nullable": true
        },
        "url": {
          "name": "url",
          "data_type": "text",
          "nullable": true
        },
        "_dlt_load_id": {
          "name": "_dlt_load_id",
          "data_type": "text",
          "nullable": false
        },
        "_dlt_id": {
          "name": "_dlt_id",
          "data_type": "text",
          "nullable": false,
          "unique": true,
          "row_key": true
        }
      },
      "write_disposition": "append",
      "name": "location",
      "resource": "location",
      "x-normalizer": {
        "seen-data": true
      }
    },
    "_dlt_pipeline_state": {
      "columns": {
        "version": {
          "name": "version",
          "data_type": "bigint",
          "nullable": false
        },
        "engine_version": {
          "name": "engine_version",
          "data_type": "bigint",
          "nullable": false
        },
        "pipeline_name": {
          "name": "pipeline_name",
          "data_type": "text",
          "nullable": false
        },
        "state": {
          "name": "state",
          "data_type": "text",
          "nullable": false
        },
        "created_at": {
          "name": "created_at",
          "data_type": "timestamp",
          "nullable": false
        },
        "version_hash": {
          "name": "version_hash",
          "data_type": "text",
          "nullable": true
        },
        "_dlt_load_id": {
          "name": "_dlt_load_id",
          "data_type": "text",
          "nullable": false
        },
        "_dlt_id": {
          "name": "_dlt_id",
          "data_type": "text",
          "nullable": false,
          "unique": true,
          "row_key": true
        }
      },
      "write_disposition": "append",
      "file_format": "preferred",
      "name": "_dlt_pipeline_state",
      "resource": "_dlt_pipeline_state",
      "x-normalizer": {
        "seen-data": true
      }
    }
  },
  "settings": {
    "detections": [
      "iso_timestamp"
    ],
    "default_hints": {
      "not_null": [
        "_dlt_id",
        "_dlt_root_id",
        "_dlt_parent_id",
        "_dlt_list_idx",
        "_dlt_load_id"
      ],
      "parent_key": [
        "_dlt_parent_id"
      ],
      "root_key": [
        "_dlt_root_id"
      ],
      "unique": [
        "_dlt_id"
      ],
      "row_key": [
        "_dlt_id"
      ]
    }
  },
  "normalizers": {
    "names": "snake_case",
    "json": {
      "module": "dlt.common.normalizers.json.relational"
    }
  },
  "previous_hashes": [
    "Gdc4n1qRXwTiCnCfqycCWAxxyGDgn7jbj2mCE7FJefs=",
    "um3SJOIZvj59vzg3myb1oaPOCmc8F4VMRHh2hVBN694="
  ]
}
```

ã“ã‚Œã‚‰ã¯ã€é€ä¿¡å…ˆã® DuckDB ã®ã‚¹ã‚­ãƒ¼ãƒã«å¯¾å¿œã—ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚ï¼ˆã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€äººé–“ç”¨ãªã®ã‹ã€ä¸Šè¨˜ã®ã¨ãŠã‚Šãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚Œã¦ã„ã¾ã™ï¼‰

`pokemon`ã€`berry`ã€`location` ã®ï¼“ã¤ãŒ [Resource](https://dlthub.com/docs/general-usage/resource) æŒ‡å®šã—ãŸã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ã€[`_dlt_version`](https://dlthub.com/docs/general-usage/destination-tables#_dlt_version-schema-version-tracking)ã€[`_dlt_loads`](https://dlthub.com/docs/general-usage/destination-tables#_dlt_loads-load-history-tracking)ã€[`_dlt_pipeline_state`](https://dlthub.com/docs/general-usage/destination-tables#_dlt_pipeline_state-pipeline-state-and-checkpoints) ã®ï¼“ã¤ãŒ dlt ã®åˆ¶å¾¡ç”¨ã§ã™ã€‚

åˆ¶å¾¡ç”¨ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä¸­èº«ã‚‚è¦—ã„ã¦ã¿ã¾ã™ã€‚hash å€¤ã§ã€ãã®å›ã®çŠ¶æ…‹ã‚’ä¿æŒã—ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

```
D select * from rest_api_data._dlt_version;
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ version â”‚ engine_version â”‚     inserted_at      â”‚ schema_name â”‚     version_hash     â”‚                    schema                    â”‚
â”‚  int64  â”‚     int64      â”‚ timestamp with timâ€¦  â”‚   varchar   â”‚       varchar        â”‚                   varchar                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    2    â”‚       11       â”‚ 2025-07-08 02:20:0â€¦  â”‚ rest_api    â”‚ bjSDsQVwCCxpVbi/s/â€¦  â”‚ {"version":2,"version_hash":"bjSDsQVwCCxpVâ€¦  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
D select * from rest_api_data._dlt_loads;
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      load_id      â”‚ schema_name â”‚ status â”‚          inserted_at          â”‚             schema_version_hash              â”‚
â”‚      varchar      â”‚   varchar   â”‚ int64  â”‚   timestamp with time zone    â”‚                   varchar                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1751941203.521931 â”‚ rest_api    â”‚   0    â”‚ 2025-07-08 02:20:05.711779+00 â”‚ bjSDsQVwCCxpVbi/s/7nk6E1Ezg9g65MV87tUMMvA8k= â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
D select * from rest_api_data._dlt_version;
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ version â”‚ engine_version â”‚     inserted_at      â”‚ schema_name â”‚     version_hash     â”‚                    schema                    â”‚
â”‚  int64  â”‚     int64      â”‚ timestamp with timâ€¦  â”‚   varchar   â”‚       varchar        â”‚                   varchar                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    2    â”‚       11       â”‚ 2025-07-08 02:20:0â€¦  â”‚ rest_api    â”‚ bjSDsQVwCCxpVbi/s/â€¦  â”‚ {"version":2,"version_hash":"bjSDsQVwCCxpVâ€¦  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### pipeline.run() ã®å†…éƒ¨

ã“ã‚Œã‚‚ [How dlt works](https://dlthub.com/docs/reference/explainers/how-dlt-works) ã«æ›¸ã„ã¦ã‚ã‚Šã¾ã™ãŒã€pipeline.run ã¯ã€[ï¼“ã¤ã®ãƒ•ã‚§ãƒ¼ã‚º](https://dlthub.com/docs/reference/explainers/how-dlt-works#the-three-phases)ã§æ§‹æˆã•ã‚Œã¦ã„ã¦ã€ãã‚Œãã‚Œä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã™ã€‚

- [Extract](https://dlthub.com/docs/reference/explainers/how-dlt-works#extract) - ã‚½ãƒ¼ã‚¹ã‹ã‚‰ãƒãƒ¼ãƒ‰ ãƒ‰ãƒ©ã‚¤ãƒ–ã«ãƒ‡ãƒ¼ã‚¿ã‚’å®Œå…¨ã«æŠ½å‡ºã—ã¾ã™ã€‚
- [Normalize](https://dlthub.com/docs/reference/explainers/how-dlt-works#normalize) - ãƒ‡ãƒ¼ã‚¿ã‚’æ¤œæŸ»ã—ã¦æ­£è¦åŒ–ã—ã€å®›å…ˆã¨äº’æ›æ€§ã®ã‚ã‚‹ã‚¹ã‚­ãƒ¼ãƒã‚’è¨ˆç®—ã—ã¾ã™ã€‚
- [Load](https://dlthub.com/docs/reference/explainers/how-dlt-works#load) -  å¿…è¦ã«å¿œã˜ã¦å®›å…ˆã§ã‚¹ã‚­ãƒ¼ãƒç§»è¡Œã‚’å®Ÿè¡Œã—ã€ãƒ‡ãƒ¼ã‚¿ã‚’å®›å…ˆã«ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚

ã¾ãŸã€ã“ã®ï¼“ã¤ã®ãƒ•ã‚§ãƒ¼ã‚ºã¯ã€å‰æå¾Œç¶šã®é–¢ä¿‚ã«ã‚ã‚‹ï¼ˆå‰ã®ãƒ•ã‚§ãƒ¼ã‚ºãŒçµ‚ã‚ã‚‰ãªã„ã¨æ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚ºã¯å®Ÿè¡Œã•ã‚Œãªã„ï¼‰ãŸã‚ã€ã‚¤ãƒ³ã‚¿ãƒ—ãƒªã‚¿ã§æ®µéšçš„ã«å®Ÿè¡Œã—ã¦ã¿ã¾ã™ã€‚

```py
$ uv run python
Python 3.12.9 (main, Mar 17 2025, 21:01:58) [Clang 20.1.0 ] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> import dlt
>>> from dlt.sources.rest_api import rest_api_source
>>> 
>>> pokemon_source = rest_api_source(
...     {
...         "client": {
...             "base_url": "https://pokeapi.co/api/v2/",
...         },
...         "resource_defaults": {
...             "endpoint": {
...                 "params": {
...                     "limit": 1000,
...                 },
...             },
...         },
...         "resources": [
...             "pokemon",
...             "berry",
...             "location",
...         ],
...     }
... )

>>> 
>>> pipeline = dlt.pipeline(
...     pipeline_name="rest_api_pokemon",
...     destination="duckdb",
...     dataset_name="rest_api_data",
... )
>>> 
```

ã“ã®æ™‚ç‚¹ã§ã€ä½œæ¥­ãƒ•ã‚©ãƒ«ãƒ€ãŒä½œã‚‰ã‚Œã¾ã™ã€‚

```sh
$ tree -a ~/.dlt
/home/ec2-user/.dlt
â””â”€â”€ pipelines
    â””â”€â”€ rest_api_pokemon
        â”œâ”€â”€ schemas
        â””â”€â”€ state.json

3 directories, 1 file
```

#### Extract

> æŠ½å‡ºãƒ•ã‚§ãƒ¼ã‚ºã§ã¯ã€dlt ã¯ã‚½ãƒ¼ã‚¹ã‹ã‚‰ãƒãƒ¼ãƒ‰ãƒ‰ãƒ©ã‚¤ãƒ–ã®æ–°ã—ã„ ãƒ­ãƒ¼ãƒ‰ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ãƒ‡ãƒ¼ã‚¿ã‚’å®Œå…¨ã«æŠ½å‡ºã—ã¾ã™ã€‚ã“ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ã¯ä¸€æ„ã® ID ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã€ã‚½ãƒ¼ã‚¹ã‹ã‚‰å—ä¿¡ã—ãŸç”Ÿãƒ‡ãƒ¼ã‚¿ãŒå«ã¾ã‚Œã¾ã™ã€‚ã•ã‚‰ã«ã€ã‚¹ã‚­ãƒ¼ãƒãƒ’ãƒ³ãƒˆã‚’æä¾›ã—ã¦ã€ä¸€éƒ¨ã®åˆ—ã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’å®šç¾©ã—ãŸã‚Šã€ä¸»ã‚­ãƒ¼ã‚„ä¸€æ„ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’è¿½åŠ ã—ãŸã‚Šã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚ã“ã®ãƒ•ã‚§ãƒ¼ã‚ºã¯ã€ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ã‚¿ãƒ«ã‚«ãƒ¼ã‚½ãƒ«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ 1 å›ã®å®Ÿè¡Œã§æŠ½å‡ºã•ã‚Œã‚‹é …ç›®ã®æ•°ã‚’åˆ¶é™ã—ã¦ã€ä¸¦åˆ—åŒ–ã§ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’èª¿æ•´ã™ã‚‹ã“ã¨ã§ã‚‚åˆ¶å¾¡ã§ãã¾ã™ã€‚ã¾ãŸã€ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã¨ãƒãƒƒãƒ—ã‚’é©ç”¨ã—ã¦å€‹äººãƒ‡ãƒ¼ã‚¿ã‚’é›£èª­åŒ–ã¾ãŸã¯å‰Šé™¤ã—ãŸã‚Šã€ãƒˆãƒ©ãƒ³ã‚¹ãƒ•ã‚©ãƒ¼ãƒãƒ¼ã‚’ä½¿ç”¨ã—ã¦æ´¾ç”Ÿãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã—ãŸã‚Šã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

Python ã‚¤ãƒ³ã‚¿ãƒ—ãƒªã‚¿ã§ç¶šã‘ã¾ã™ã€‚

```py
>>> pipeline.extract(pokemon_source)
2025-07-08 05:48:33,220|[WARNING]|26071|139882239305536|dlt|client.py|detect_paginator:312|Fallback paginator used: SinglePagePaginator at 7f38b5b07bc0. Please provide right paginator manually.
ExtractInfo(pipeline=<dlt.pipeline.pipeline.Pipeline object at 0x7f38b67073b0>, metrics={'1751953713.128814': [{'started_at': DateTime(2025, 7, 8, 5, 48, 33, 130317, tzinfo=Timezone('UTC')), 'finished_at': DateTime(2025, 7, 8, 5, 48, 33, 336674, tzinfo=Timezone('UTC')), 'schema_name': 'rest_api', 'job_metrics': {'pokemon.7bc3cd353d.typed-jsonl': DataWriterMetrics(file_path='/home/ec2-user/.dlt/pipelines/rest_api_pokemon/normalize/65328621ae5f8924/1751953713.128814/new_jobs/pokemon.7bc3cd353d.0.typed-jsonl', items_count=1302, file_size=89576, created=1751953713.1911597, last_modified=1751953713.2932928), 'berry.b25d2f5b9b.typed-jsonl': DataWriterMetrics(file_path='/home/ec2-user/.dlt/pipelines/rest_api_pokemon/normalize/65328621ae5f8924/1751953713.128814/new_jobs/berry.b25d2f5b9b.0.typed-jsonl', items_count=64, file_size=3917, created=1751953713.2216043, last_modified=1751953713.2216108), 'location.0aaf26aeae.typed-jsonl': DataWriterMetrics(file_path='/home/ec2-user/.dlt/pipelines/rest_api_pokemon/normalize/65328621ae5f8924/1751953713.128814/new_jobs/location.0aaf26aeae.0.typed-jsonl', items_count=1070, file_size=79277, created=1751953713.2685933, last_modified=1751953713.3165731)}, 'table_metrics': {'pokemon': DataWriterMetrics(file_path='', items_count=1302, file_size=89576, created=1751953713.1911597, last_modified=1751953713.2932928), 'berry': DataWriterMetrics(file_path='', items_count=64, file_size=3917, created=1751953713.2216043, last_modified=1751953713.2216108), 'location': DataWriterMetrics(file_path='', items_count=1070, file_size=79277, created=1751953713.2685933, last_modified=1751953713.3165731)}, 'resource_metrics': {'pokemon': DataWriterMetrics(file_path='', items_count=1302, file_size=89576, created=1751953713.1911597, last_modified=1751953713.2932928), 'berry': DataWriterMetrics(file_path='', items_count=64, file_size=3917, created=1751953713.2216043, last_modified=1751953713.2216108), 'location': DataWriterMetrics(file_path='', items_count=1070, file_size=79277, created=1751953713.2685933, last_modified=1751953713.3165731)}, 'dag': [('pokemon', 'pokemon'), ('berry', 'berry'), ('location', 'location')], 'hints': {'pokemon': {'write_disposition': 'append'}, 'berry': {'write_disposition': 'append'}, 'location': {'write_disposition': 'append'}}}, {'started_at': DateTime(2025, 7, 8, 5, 48, 33, 340304, tzinfo=Timezone('UTC')), 'finished_at': DateTime(2025, 7, 8, 5, 48, 33, 353538, tzinfo=Timezone('UTC')), 'schema_name': 'rest_api', 'job_metrics': {'_dlt_pipeline_state.fa339c289f.typed-jsonl': DataWriterMetrics(file_path='/home/ec2-user/.dlt/pipelines/rest_api_pokemon/normalize/65328621ae5f8924/1751953713.128814/new_jobs/_dlt_pipeline_state.fa339c289f.0.typed-jsonl', items_count=1, file_size=493, created=1751953713.3420017, last_modified=1751953713.342006)}, 'table_metrics': {'_dlt_pipeline_state': DataWriterMetrics(file_path='', items_count=1, file_size=493, created=1751953713.3420017, last_modified=1751953713.342006)}, 'resource_metrics': {'_dlt_pipeline_state': DataWriterMetrics(file_path='', items_count=1, file_size=493, created=1751953713.3420017, last_modified=1751953713.342006)}, 'dag': [('_dlt_pipeline_state', '_dlt_pipeline_state')], 'hints': {'_dlt_pipeline_state': {'columns': 'version:\n  name: version\n  data_type: bigint\n  nullable: false\nengine_version:\n  name: engine_version\n  data_type: bigint\n  nullable: false\npipeline_name:\n  name: pipeline_name\n  data_type: text\n  nullable: false\nstate:\n  name: state\n  data_type: text\n  nullable: false\ncreated_at:\n  name: created_at\n  data_type: timestamp\n  nullable: false\nversion_hash:\n  name: version_hash\n  data_type: text\n  nullable: true\n_dlt_load_id:\n  name: _dlt_load_id\n  data_type: text\n  nullable: false\n', 'write_disposition': 'append', 'file_format': 'preferred', 'original_columns': 'dict'}}}]}, extract_data_info=[{'name': 'rest_api', 'data_type': 'source'}], loads_ids=['1751953713.128814'], load_packages=[LoadPackageInfo(load_id='1751953713.128814', package_path='/home/ec2-user/.dlt/pipelines/rest_api_pokemon/normalize/extracted/1751953713.128814', state='extracted', schema=Schema rest_api at 139881552664320, schema_update={}, completed_at=None, jobs={'started_jobs': [], 'failed_jobs': [], 'new_jobs': [LoadJobInfo(state='new_jobs', file_path='/home/ec2-user/.dlt/pipelines/rest_api_pokemon/normalize/extracted/1751953713.128814/new_jobs/pokemon.7bc3cd353d.0.typed-jsonl', file_size=11308, created_at=DateTime(2025, 7, 8, 5, 48, 33, 323021, tzinfo=Timezone('UTC')), elapsed=0.03204035758972168, job_file_info=ParsedLoadJobFileName(table_name='pokemon', file_id='7bc3cd353d', retry_count=0, file_format='typed-jsonl'), failed_message=None), LoadJobInfo(state='new_jobs', file_path='/home/ec2-user/.dlt/pipelines/rest_api_pokemon/normalize/extracted/1751953713.128814/new_jobs/berry.b25d2f5b9b.0.typed-jsonl', file_size=591, created_at=DateTime(2025, 7, 8, 5, 48, 33, 323021, tzinfo=Timezone('UTC')), elapsed=0.032064199447631836, job_file_info=ParsedLoadJobFileName(table_name='berry', file_id='b25d2f5b9b', retry_count=0, file_format='typed-jsonl'), failed_message=None), LoadJobInfo(state='new_jobs', file_path='/home/ec2-user/.dlt/pipelines/rest_api_pokemon/normalize/extracted/1751953713.128814/new_jobs/location.0aaf26aeae.0.typed-jsonl', file_size=9972, created_at=DateTime(2025, 7, 8, 5, 48, 33, 323021, tzinfo=Timezone('UTC')), elapsed=0.03207993507385254, job_file_info=ParsedLoadJobFileName(table_name='location', file_id='0aaf26aeae', retry_count=0, file_format='typed-jsonl'), failed_message=None), LoadJobInfo(state='new_jobs', file_path='/home/ec2-user/.dlt/pipelines/rest_api_pokemon/normalize/extracted/1751953713.128814/new_jobs/_dlt_pipeline_state.fa339c289f.0.typed-jsonl', file_size=484, created_at=DateTime(2025, 7, 8, 5, 48, 33, 343021, tzinfo=Timezone('UTC')), elapsed=0.01209259033203125, job_file_info=ParsedLoadJobFileName(table_name='_dlt_pipeline_state', file_id='fa339c289f', retry_count=0, file_format='typed-jsonl'), failed_message=None)], 'completed_jobs': []})], first_run=True)
```

ã“ã®æ™‚ç‚¹ã®ä½œæ¥­ãƒ•ã‚©ãƒ«ãƒ€ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚æœ€åˆã«è¦‹ãŸ `run()` ã®å®Ÿè¡Œå¾Œã§ã¯ç©ºã«ãªã£ã¦ã„ãŸ normalize ãƒ•ã‚©ãƒ«ãƒ€ã«ãƒ‡ãƒ¼ã‚¿ãŒä½œæˆã•ã‚Œã€`schemas/rest_api.schema.json` ã‚‚ä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚

```sh
$ tree -a ~/.dlt
/home/ec2-user/.dlt
â”œâ”€â”€ .anonymous_id
â””â”€â”€ pipelines
    â””â”€â”€ rest_api_pokemon
        â”œâ”€â”€ normalize
        â”‚   â”œâ”€â”€ .version
        â”‚   â””â”€â”€ extracted
        â”‚       â””â”€â”€ 1751953713.128814
        â”‚           â”œâ”€â”€ completed_jobs
        â”‚           â”œâ”€â”€ failed_jobs
        â”‚           â”œâ”€â”€ load_package_state.json
        â”‚           â”œâ”€â”€ new_jobs
        â”‚           â”‚   â”œâ”€â”€ _dlt_pipeline_state.fa339c289f.0.typed-jsonl
        â”‚           â”‚   â”œâ”€â”€ berry.b25d2f5b9b.0.typed-jsonl
        â”‚           â”‚   â”œâ”€â”€ location.0aaf26aeae.0.typed-jsonl
        â”‚           â”‚   â””â”€â”€ pokemon.7bc3cd353d.0.typed-jsonl
        â”‚           â”œâ”€â”€ schema.json
        â”‚           â””â”€â”€ started_jobs
        â”œâ”€â”€ schemas
        â”‚   â””â”€â”€ rest_api.schema.json
        â”œâ”€â”€ state.json
        â””â”€â”€ trace.pickle

10 directories, 11 files
```

##### .json ãƒ•ã‚¡ã‚¤ãƒ«

`extract()` æ™‚ç‚¹ã§ç”Ÿæˆã•ã‚Œã¦ã„ãŸ .json ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ä»¥ä¸‹ã®ï¼”ã¤

- state.json
- schemas/rest_api.schema.json
- normalize/extracted/1751953713.128814/load_package_state.json
- normalize/extracted/1751953713.128814/schema.json

ãŸã ã—ã€rest_api.schema.json ã¨ schema.json ã¯ã€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆä»¥å¤–ã¯åŒã˜

##### .typed-jsonl ãƒ•ã‚¡ã‚¤ãƒ«

gzip åœ§ç¸®ã•ã‚ŒãŸ JSON ãƒ•ã‚¡ã‚¤ãƒ«ãªã®ã§ã€gunzip ã™ã‚‹ã¨ã‚¨ãƒ‡ã‚£ã‚¿ã§è¦‹ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
å€¤ã¯ã€Resource ã‹ã‚‰ã®æˆ»ã‚Šã®ã¾ã¾ã®ã‚ˆã†ã§ã€dlt ã®åˆ¶å¾¡ç”¨ã®ã‚«ãƒ©ãƒ ãªã©ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

```json: normalize/extracted/1751953713.128814/new_jobs/berry.b25d2f5b9b.0.typed-jsonl
[
    {
        "name": "cheri",
        "url": "https://pokeapi.co/api/v2/berry/1/"
    },
    {
        "name": "chesto",
        "url": "https://pokeapi.co/api/v2/berry/2/"
    },
    {
        "name": "pecha",
        "url": "https://pokeapi.co/api/v2/berry/3/"
    },
```

ä¸Šè¨˜ã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«ã®å…ˆé ­éƒ¨åˆ†ã‚’ gunzip ã—ã¦ã€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå‡¦ç†ã—ã¦ã„ã¾ã™ã€‚

#### Normalize

ç¶šã„ã¦ã€normalize ã§ã™ã€‚

> æ­£è¦åŒ–ãƒ•ã‚§ãƒ¼ã‚ºã§ã¯ã€dlt ã¯ãƒ‡ãƒ¼ã‚¿ã‚’æ¤œæŸ»ã—ã¦æ­£è¦åŒ–ã—ã€å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã«å¯¾å¿œã™ã‚‹ã‚¹ã‚­ãƒ¼ãƒã‚’è¨ˆç®—ã—ã¾ã™ã€‚ã‚¹ã‚­ãƒ¼ãƒã¯ã€æ–°ã—ã„åˆ—ã‚„ãƒ†ãƒ¼ãƒ–ãƒ«ãªã©ã®å°†æ¥ã®ã‚½ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿ã®å¤‰æ›´ã«å¯¾å¿œã™ã‚‹ãŸã‚ã«è‡ªå‹•çš„ã«é€²åŒ–ã—ã¾ã™ã€‚ã¾ãŸã€dlt ã¯ã€æ¤œå‡ºã•ã‚ŒãŸå€¤ãŒå‰å›ã®å®Ÿè¡Œä¸­ã«è¨ˆç®—ã•ã‚ŒãŸã‚¹ã‚­ãƒ¼ãƒã¨ä¸€è‡´ã—ãªã„å ´åˆã¯ã€ãƒã‚¹ãƒˆã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’å­ãƒ†ãƒ¼ãƒ–ãƒ«ã«ãƒã‚¹ãƒˆè§£é™¤ã—ã€ãƒãƒªã‚¢ãƒ³ãƒˆåˆ—ã‚’ä½œæˆã—ã¾ã™ã€‚æ­£è¦åŒ–ãƒ•ã‚§ãƒ¼ã‚ºã®çµæœã¯ã€å®›å…ˆãŒç†è§£ã§ãã‚‹å½¢å¼ã§æ­£è¦åŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã™ã‚‹æ›´æ–°ã•ã‚ŒãŸãƒ­ãƒ¼ãƒ‰ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã€ãƒ‡ãƒ¼ã‚¿ã‚’å®›å…ˆã«ç§»è¡Œã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã§ãã‚‹å®Œå…¨ãªã‚¹ã‚­ãƒ¼ãƒã§ã™ã€‚æ­£è¦åŒ–ãƒ•ã‚§ãƒ¼ã‚ºã¯ã€ãŸã¨ãˆã°ã€å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã® è¨±å¯ã•ã‚Œã‚‹ãƒã‚¹ãƒˆãƒ¬ãƒ™ãƒ«ã‚’å®šç¾© ã—ãŸã‚Šã€ã‚¹ã‚­ãƒ¼ãƒãŒã©ã®ã‚ˆã†ã«é€²åŒ–ã™ã‚‹ã‹ã€ãŠã‚ˆã³é©åˆã—ãªã„è¡ŒãŒã©ã®ã‚ˆã†ã«å‡¦ç†ã•ã‚Œã‚‹ã‹ã‚’åˆ¶å¾¡ã™ã‚‹ ã‚¹ã‚­ãƒ¼ãƒã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’é©ç”¨ã—ãŸã‚Šã™ã‚‹ã“ã¨ã§åˆ¶å¾¡ã§ãã¾ã™ã€‚ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­å®šã‚‚ ä½¿ç”¨å¯èƒ½ã§ã™ã€‚


```py
>>> pipeline.normalize()
NormalizeInfo(pipeline=<dlt.pipeline.pipeline.Pipeline object at 0x7f38b67073b0>, metrics={'1751953713.128814': [{'started_at': DateTime(2025, 7, 8, 7, 40, 29, 401318, tzinfo=Timezone('UTC')), 'finished_at': DateTime(2025, 7, 8, 7, 40, 29, 455414, tzinfo=Timezone('UTC')), 'job_metrics': {'pokemon.8b737a2346.insert_values': DataWriterMetrics(file_path='/home/ec2-user/.dlt/pipelines/rest_api_pokemon/load/new/1751953713.128814/new_jobs/pokemon.8b737a2346.0.insert_values', items_count=1302, file_size=127392, created=1751960429.4061627, last_modified=1751960429.416432), 'berry.3d831d8f67.insert_values': DataWriterMetrics(file_path='/home/ec2-user/.dlt/pipelines/rest_api_pokemon/load/new/1751953713.128814/new_jobs/berry.3d831d8f67.0.insert_values', items_count=64, file_size=5831, created=1751960429.4174974, last_modified=1751960429.4179692), 'location.5aaa1586bf.insert_values': DataWriterMetrics(file_path='/home/ec2-user/.dlt/pipelines/rest_api_pokemon/load/new/1751953713.128814/new_jobs/location.5aaa1586bf.0.insert_values', items_count=1070, file_size=110365, created=1751960429.4197912, last_modified=1751960429.4280107), '_dlt_pipeline_state.897a9fd413.insert_values': DataWriterMetrics(file_path='/home/ec2-user/.dlt/pipelines/rest_api_pokemon/load/new/1751953713.128814/new_jobs/_dlt_pipeline_state.897a9fd413.0.insert_values', items_count=1, file_size=543, created=1751960429.4289558, last_modified=1751960429.4289594)}, 'table_metrics': {'pokemon': DataWriterMetrics(file_path='', items_count=1302, file_size=127392, created=1751960429.4061627, last_modified=1751960429.416432), 'berry': DataWriterMetrics(file_path='', items_count=64, file_size=5831, created=1751960429.4174974, last_modified=1751960429.4179692), 'location': DataWriterMetrics(file_path='', items_count=1070, file_size=110365, created=1751960429.4197912, last_modified=1751960429.4280107), '_dlt_pipeline_state': DataWriterMetrics(file_path='', items_count=1, file_size=543, created=1751960429.4289558, last_modified=1751960429.4289594)}}]}, loads_ids=['1751953713.128814'], load_packages=[LoadPackageInfo(load_id='1751953713.128814', package_path='/home/ec2-user/.dlt/pipelines/rest_api_pokemon/load/normalized/1751953713.128814', state='normalized', schema=Schema rest_api at 139881553269472, schema_update={}, completed_at=None, jobs={'started_jobs': [], 'failed_jobs': [], 'new_jobs': [LoadJobInfo(state='new_jobs', file_path='/home/ec2-user/.dlt/pipelines/rest_api_pokemon/load/normalized/1751953713.128814/new_jobs/pokemon.8b737a2346.0.insert_values', file_size=28504, created_at=DateTime(2025, 7, 8, 7, 40, 29, 433150, tzinfo=Timezone('UTC')), elapsed=0.02295827865600586, job_file_info=ParsedLoadJobFileName(table_name='pokemon', file_id='8b737a2346', retry_count=0, file_format='insert_values'), failed_message=None), LoadJobInfo(state='new_jobs', file_path='/home/ec2-user/.dlt/pipelines/rest_api_pokemon/load/normalized/1751953713.128814/new_jobs/berry.3d831d8f67.0.insert_values', file_size=1485, created_at=DateTime(2025, 7, 8, 7, 40, 29, 433150, tzinfo=Timezone('UTC')), elapsed=0.022977113723754883, job_file_info=ParsedLoadJobFileName(table_name='berry', file_id='3d831d8f67', retry_count=0, file_format='insert_values'), failed_message=None), LoadJobInfo(state='new_jobs', file_path='/home/ec2-user/.dlt/pipelines/rest_api_pokemon/load/normalized/1751953713.128814/new_jobs/location.5aaa1586bf.0.insert_values', file_size=23973, created_at=DateTime(2025, 7, 8, 7, 40, 29, 443150, tzinfo=Timezone('UTC')), elapsed=0.012989997863769531, job_file_info=ParsedLoadJobFileName(table_name='location', file_id='5aaa1586bf', retry_count=0, file_format='insert_values'), failed_message=None), LoadJobInfo(state='new_jobs', file_path='/home/ec2-user/.dlt/pipelines/rest_api_pokemon/load/normalized/1751953713.128814/new_jobs/_dlt_pipeline_state.897a9fd413.0.insert_values', file_size=515, created_at=DateTime(2025, 7, 8, 7, 40, 29, 443150, tzinfo=Timezone('UTC')), elapsed=0.013002395629882812, job_file_info=ParsedLoadJobFileName(table_name='_dlt_pipeline_state', file_id='897a9fd413', retry_count=0, file_format='insert_values'), failed_message=None)], 'completed_jobs': []})], first_run=True)
```

ãã—ã¦ã€ä½œæ¥­ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã€äºˆæƒ³é€šã‚Š `normalize/extracted` ã‹ã‚‰ `load/normalized` ã¸ã‚·ãƒ•ãƒˆã—ã¾ã—ãŸã€‚

```sh
$ tree -a ~/.dlt
/home/ec2-user/.dlt
â”œâ”€â”€ .anonymous_id
â””â”€â”€ pipelines
    â””â”€â”€ rest_api_pokemon
        â”œâ”€â”€ load
        â”‚   â”œâ”€â”€ .version
        â”‚   â”œâ”€â”€ loaded
        â”‚   â”œâ”€â”€ new
        â”‚   â””â”€â”€ normalized
        â”‚       â””â”€â”€ 1751953713.128814
        â”‚           â”œâ”€â”€ completed_jobs
        â”‚           â”œâ”€â”€ failed_jobs
        â”‚           â”œâ”€â”€ load_package_state.json
        â”‚           â”œâ”€â”€ new_jobs
        â”‚           â”‚   â”œâ”€â”€ _dlt_pipeline_state.897a9fd413.0.insert_values
        â”‚           â”‚   â”œâ”€â”€ berry.3d831d8f67.0.insert_values
        â”‚           â”‚   â”œâ”€â”€ location.5aaa1586bf.0.insert_values
        â”‚           â”‚   â””â”€â”€ pokemon.8b737a2346.0.insert_values
        â”‚           â”œâ”€â”€ schema.json
        â”‚           â”œâ”€â”€ schema_updates.json
        â”‚           â””â”€â”€ started_jobs
        â”œâ”€â”€ normalize
        â”‚   â”œâ”€â”€ .version
        â”‚   â””â”€â”€ extracted
        â”œâ”€â”€ schemas
        â”‚   â””â”€â”€ rest_api.schema.json
        â”œâ”€â”€ state.json
        â””â”€â”€ trace.pickle

14 directories, 13 files
```

##### state.json

`extract()` æ™‚ç‚¹ã¨åŒã˜ã§ã™ã€‚

##### schemas/rest_api.schema.json ã¨ schema.json

`extract()` æ™‚ç‚¹ã§ã¯ã€Schema æ¨å®šãŒã•ã‚Œã¦ã„ã¾ã›ã‚“ã§ã—ãŸã®ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ã«æƒ…å ±ãŒè¿½åŠ ã•ã‚Œã¦ã„ã¾ã™ã€‚

```diff: rest_api.schema.json
--- ext/rest_api.schema.json    2025-07-08 08:43:26.903138339 +0000
+++ nor/rest_api.schema.json    2025-07-08 08:43:39.153138116 +0000
@@ -1,6 +1,6 @@
 {
-  "version": 1,
-  "version_hash": "Gdc4n1qRXwTiCnCfqycCWAxxyGDgn7jbj2mCE7FJefs=",
+  "version": 2,
+  "version_hash": "bjSDsQVwCCxpVbi/s/7nk6E1Ezg9g65MV87tUMMvA8k=",
   "engine_version": 11,
   "name": "rest_api",
   "tables": {
@@ -76,22 +76,100 @@
       "description": "Created by DLT. Tracks completed loads"
     },
     "pokemon": {
-      "columns": {},
+      "columns": {
+        "name": {
+          "name": "name",
+          "data_type": "text",
+          "nullable": true
+        },
+        "url": {
+          "name": "url",
+          "data_type": "text",
+          "nullable": true
+        },
+        "_dlt_load_id": {
+          "name": "_dlt_load_id",
+          "data_type": "text",
+          "nullable": false
+        },
+        "_dlt_id": {
+          "name": "_dlt_id",
+          "data_type": "text",
+          "nullable": false,
+          "unique": true,
+          "row_key": true
+        }
+      },
       "write_disposition": "append",
       "name": "pokemon",
-      "resource": "pokemon"
+      "resource": "pokemon",
+      "x-normalizer": {
+        "seen-data": true
+      }
     },
     "berry": {
-      "columns": {},
+      "columns": {
+        "name": {
+          "name": "name",
+          "data_type": "text",
+          "nullable": true
+        },
+        "url": {
+          "name": "url",
+          "data_type": "text",
+          "nullable": true
+        },
+        "_dlt_load_id": {
+          "name": "_dlt_load_id",
+          "data_type": "text",
+          "nullable": false
+        },
+        "_dlt_id": {
+          "name": "_dlt_id",
+          "data_type": "text",
+          "nullable": false,
+          "unique": true,
+          "row_key": true
+        }
+      },
       "write_disposition": "append",
       "name": "berry",
-      "resource": "berry"
+      "resource": "berry",
+      "x-normalizer": {
+        "seen-data": true
+      }
     },
     "location": {
-      "columns": {},
+      "columns": {
+        "name": {
+          "name": "name",
+          "data_type": "text",
+          "nullable": true
+        },
+        "url": {
+          "name": "url",
+          "data_type": "text",
+          "nullable": true
+        },
+        "_dlt_load_id": {
+          "name": "_dlt_load_id",
+          "data_type": "text",
+          "nullable": false
+        },
+        "_dlt_id": {
+          "name": "_dlt_id",
+          "data_type": "text",
+          "nullable": false,
+          "unique": true,
+          "row_key": true
+        }
+      },
       "write_disposition": "append",
       "name": "location",
-      "resource": "location"
+      "resource": "location",
+      "x-normalizer": {
+        "seen-data": true
+      }
     },
     "_dlt_pipeline_state": {
       "columns": {
@@ -129,12 +207,22 @@
           "name": "_dlt_load_id",
           "data_type": "text",
           "nullable": false
+        },
+        "_dlt_id": {
+          "name": "_dlt_id",
+          "data_type": "text",
+          "nullable": false,
+          "unique": true,
+          "row_key": true
         }
       },
       "write_disposition": "append",
       "file_format": "preferred",
       "name": "_dlt_pipeline_state",
-      "resource": "_dlt_pipeline_state"
+      "resource": "_dlt_pipeline_state",
+      "x-normalizer": {
+        "seen-data": true
+      }
     }
   },
   "settings": {
@@ -170,6 +258,7 @@
     }
   },
   "previous_hashes": [
+    "Gdc4n1qRXwTiCnCfqycCWAxxyGDgn7jbj2mCE7FJefs=",
     "um3SJOIZvj59vzg3myb1oaPOCmc8F4VMRHh2hVBN694="
   ]
 }
```

##### load/normalized/1751953713.128814/load_package_state.json

`extract()` æ™‚ç‚¹ã¨åŒã˜ã§ã™ã€‚

##### load/normalized/1751953713.128814/schema_updates.json

`normalize()` ã§è¿½åŠ ã•ã‚Œã¦ã„ã¾ã™ã€‚schema.json ã®æ›´æ–°éƒ¨åˆ†ã«è©²å½“ã—ã¾ã™ã€‚

```json: load/normalized/1751953713.128814/schema_updates.json
{
    "pokemon": {
        "columns": {
            "name": {
                "name": "name",
                "data_type": "text",
                "nullable": true
            },
            "url": {
                "name": "url",
                "data_type": "text",
                "nullable": true
            },
            "_dlt_load_id": {
                "name": "_dlt_load_id",
                "data_type": "text",
                "nullable": false
            },
            "_dlt_id": {
                "name": "_dlt_id",
                "data_type": "text",
                "nullable": false,
                "unique": true,
                "row_key": true
            }
        },
        "write_disposition": "append",
        "name": "pokemon",
        "resource": "pokemon"
    },
    "berry": {
        "columns": {
            "name": {
                "name": "name",
                "data_type": "text",
                "nullable": true
            },
            "url": {
                "name": "url",
                "data_type": "text",
                "nullable": true
            },
            "_dlt_load_id": {
                "name": "_dlt_load_id",
                "data_type": "text",
                "nullable": false
            },
            "_dlt_id": {
                "name": "_dlt_id",
                "data_type": "text",
                "nullable": false,
                "unique": true,
                "row_key": true
            }
        },
        "write_disposition": "append",
        "name": "berry",
        "resource": "berry"
    },
    "location": {
        "columns": {
            "name": {
                "name": "name",
                "data_type": "text",
                "nullable": true
            },
            "url": {
                "name": "url",
                "data_type": "text",
                "nullable": true
            },
            "_dlt_load_id": {
                "name": "_dlt_load_id",
                "data_type": "text",
                "nullable": false
            },
            "_dlt_id": {
                "name": "_dlt_id",
                "data_type": "text",
                "nullable": false,
                "unique": true,
                "row_key": true
            }
        },
        "write_disposition": "append",
        "name": "location",
        "resource": "location"
    },
    "_dlt_pipeline_state": {
        "columns": {
            "_dlt_id": {
                "name": "_dlt_id",
                "data_type": "text",
                "nullable": false,
                "unique": true,
                "row_key": true
            }
        },
        "write_disposition": "append",
        "file_format": "preferred",
        "name": "_dlt_pipeline_state",
        "resource": "_dlt_pipeline_state"
    }
}
```

##### .insert_values ãƒ•ã‚¡ã‚¤ãƒ«

ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚ gzip åœ§ç¸®ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚.typed-jsonl ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã¯é•ã£ã¦ã€INSERT æ–‡ãªã®ã¨ dlt ã®åˆ¶å¾¡ç”¨é …ç›®ãŒè¿½åŠ ã•ã‚Œã¦ã„ã¾ã™ã€‚

```sql: load/normalized/1751953713.128814/new_jobs/berry.3d831d8f67.0.insert_values
INSERT INTO {}("name","url","_dlt_load_id","_dlt_id")
VALUES
(E'cheri',E'https://pokeapi.co/api/v2/berry/1/',E'1751953713.128814',E'rD+cQgbhNw+00Q'),
(E'chesto',E'https://pokeapi.co/api/v2/berry/2/',E'1751953713.128814',E'w1ozBUchmgOyUA'),
(E'pecha',E'https://pokeapi.co/api/v2/berry/3/',E'1751953713.128814',E'Wt2UDpLn8i1Wqw'),
```

ä¸Šè¨˜ã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«ã®å…ˆé ­éƒ¨åˆ†ã‚’ gunzip ã—ã¦ã„ã¾ã™ã€‚

#### Load

æœ€å¾Œã¯ load ã§ã™ã€‚

> ãƒ­ãƒ¼ãƒ‰ãƒ•ã‚§ãƒ¼ã‚ºã§ã¯ã€dlt ã¯æœ€åˆã«å¿…è¦ã«å¿œã˜ã¦å®›å…ˆã§ã‚¹ã‚­ãƒ¼ãƒç§»è¡Œã‚’å®Ÿè¡Œã—ã€æ¬¡ã«ãƒ‡ãƒ¼ã‚¿ã‚’å®›å…ˆã«èª­ã¿è¾¼ã¿ã¾ã™ã€‚dlt ã¯ã€å¤§è¦æ¨¡ãªèª­ã¿è¾¼ã¿ã‚’ä¸¦åˆ—åŒ–ã§ãã‚‹ã‚ˆã†ã«ã€ãƒ­ãƒ¼ãƒ‰ã‚¸ãƒ§ãƒ–ã¨å‘¼ã°ã‚Œã‚‹å°ã•ãªãƒãƒ£ãƒ³ã‚¯ã§ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã™ã€‚å®›å…ˆã¸ã®æ¥ç¶šãŒå¤±æ•—ã—ãŸå ´åˆã¯ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å†å®Ÿè¡Œã—ã¦ã‚‚å®‰å…¨ã§ã‚ã‚Šã€dlt ã¯ç¾åœ¨ã®èª­ã¿è¾¼ã¿ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‹ã‚‰ã™ã¹ã¦ã®ãƒ­ãƒ¼ãƒ‰ã‚¸ãƒ§ãƒ–ã®èª­ã¿è¾¼ã¿ã‚’ç¶šè¡Œã—ã¾ã™ã€‚dlt ã¯ã€å†…éƒ¨ dlt ã‚¹ã‚­ãƒ¼ãƒã€ã™ã¹ã¦ã®ãƒ­ãƒ¼ãƒ‰ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«é–¢ã™ã‚‹æƒ…å ±ã€ãŠã‚ˆã³ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ã‚¿ãƒ«ã«ä½¿ç”¨ã•ã‚Œã‚‹ã„ãã¤ã‹ã®çŠ¶æ…‹æƒ…å ±ãªã©ã‚’æ ¼ç´ã™ã‚‹ç‰¹åˆ¥ãªãƒ†ãƒ¼ãƒ–ãƒ«ã‚‚ä½œæˆã—ã¾ã™ã€‚ã“ã‚Œã‚‰ã®æƒ…å ±ã¯ã€ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ã‚¿ãƒ«ã«å‰å›ã®å®Ÿè¡Œã‹ã‚‰åˆ¥ã®ãƒã‚·ãƒ³ã¸ã®å¢—åˆ†çŠ¶æ…‹ã‚’å¾©å…ƒã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚ãƒ­ãƒ¼ãƒ‰ãƒ•ã‚§ãƒ¼ã‚ºã‚’åˆ¶å¾¡ã™ã‚‹æ–¹æ³•ã«ã¯ã€ç•°ãªã‚‹ write_dispositions ã‚’ä½¿ç”¨ã—ã¦å®›å…ˆã®ãƒ‡ãƒ¼ã‚¿ã‚’ç½®ãæ›ãˆãŸã‚Šã€å˜ã«è¿½åŠ ã—ãŸã‚Šã€ãƒ†ãƒ¼ãƒ–ãƒ«ã”ã¨ã«æ§‹æˆã§ãã‚‹ç‰¹å®šã®ãƒãƒ¼ã‚¸ã‚­ãƒ¼ã§ãƒãƒ¼ã‚¸ã—ãŸã‚Šã™ã‚‹æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚ä¸€éƒ¨ã®å®›å…ˆã§ã¯ã€ãƒã‚±ãƒƒãƒˆãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ä¸Šã®ãƒªãƒ¢ãƒ¼ãƒˆã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚ã¾ãŸã€dlt ã¯ deltables ã‚„ iceberg ãªã©ã®æœ€æ–°ã®ã‚ªãƒ¼ãƒ—ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«å½¢å¼ã‚‚ã‚µãƒãƒ¼ãƒˆã—ã¦ãŠã‚Šã€ãƒªãƒãƒ¼ã‚¹ ETL ã‚‚å¯èƒ½ã§ã™ã€‚

```py
>>> load_info = pipeline.load()
>>> print(load_info)
Pipeline rest_api_pokemon load step completed in 0.18 seconds
1 load package(s) were loaded to destination duckdb and into dataset rest_api_data
The duckdb destination used duckdb:////home/ec2-user/work/mds/dlt-getting-started/rest-api/rest_api_pokemon.duckdb location to store data
Load package 1751953713.128814 is LOADED and contains no failed jobs
```

ä½œæ¥­ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã¯ã€å½“ç„¶ã€run ã®ã¨ãã¨åŒã˜ã‚ˆã†ãªçŠ¶æ…‹ã«ãªã‚Šã¾ã™ã€‚
ã‚‚ã¡ã‚ã‚“ã€DuckDB ã«ãƒ­ãƒ¼ãƒ‰ã‚‚ã§ãã¦ã„ã¾ã™ã€‚

```sh
$ tree -a ~/.dlt
/home/ec2-user/.dlt
â”œâ”€â”€ .anonymous_id
â””â”€â”€ pipelines
    â””â”€â”€ rest_api_pokemon
        â”œâ”€â”€ load
        â”‚   â”œâ”€â”€ .version
        â”‚   â”œâ”€â”€ loaded
        â”‚   â”‚   â””â”€â”€ 1751953713.128814
        â”‚   â”‚       â”œâ”€â”€ applied_schema_updates.json
        â”‚   â”‚       â”œâ”€â”€ completed_jobs
        â”‚   â”‚       â”‚   â”œâ”€â”€ _dlt_pipeline_state.897a9fd413.0.insert_values
        â”‚   â”‚       â”‚   â”œâ”€â”€ berry.3d831d8f67.0.insert_values
        â”‚   â”‚       â”‚   â”œâ”€â”€ location.5aaa1586bf.0.insert_values
        â”‚   â”‚       â”‚   â””â”€â”€ pokemon.8b737a2346.0.insert_values
        â”‚   â”‚       â”œâ”€â”€ failed_jobs
        â”‚   â”‚       â”œâ”€â”€ load_package_state.json
        â”‚   â”‚       â”œâ”€â”€ new_jobs
        â”‚   â”‚       â”œâ”€â”€ package_completed.json
        â”‚   â”‚       â”œâ”€â”€ schema.json
        â”‚   â”‚       â””â”€â”€ started_jobs
        â”‚   â”œâ”€â”€ new
        â”‚   â””â”€â”€ normalized
        â”œâ”€â”€ normalize
        â”‚   â”œâ”€â”€ .version
        â”‚   â””â”€â”€ extracted
        â”œâ”€â”€ schemas
        â”‚   â””â”€â”€ rest_api.schema.json
        â”œâ”€â”€ state.json
        â””â”€â”€ trace.pickle

14 directories, 14 files
```

##### state.json

`extract()`ã€`normalize()` æ™‚ç‚¹ã‹ã‚‰ã®æ›´æ–°ã•ã‚Œã€ `_local.first_run` ã®å€¤ãŒ `true` ã‹ã‚‰ `false` ã«å¤‰ã‚ã‚Šã¾ã—ãŸã®ã§ã€ã“ã® `load()` ä»¥é™ã¯ã€å‰å›ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹æƒ³å®šã§å‹•ãã¾ã™ã€‚

##### schemas/rest_api.schema.json ã¨ schema.json

`normalize()` ã§ç¢ºå®šã—ãŸ schema ã¨åŒã˜ã§ã™ã€‚

##### load/loaded/1751953713.128814/applied_schema_updates.json

åå‰çš„ã«ã‚‚ `normalize()` ã§ä½œæˆã•ã‚ŒãŸ `schema_updates.json` ã«å¯¾å¿œã—ã¦ã„ãã†ã§ã™ãŒã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã€dlt ã®åˆ¶å¾¡ç”¨ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚¹ã‚­ãƒ¼ãƒãŒè¿½åŠ ã•ã‚Œã¦ã„ã¾ã™ã€‚

```diff: applied_schema_updates.json
--- nor/schema_updates.json     2025-07-08 08:25:07.673154450 +0000
+++ loa/applied_schema_updates.json     2025-07-08 08:25:41.403152288 +0000
@@ -26,7 +26,10 @@
         },
         "write_disposition": "append",
         "name": "pokemon",
-        "resource": "pokemon"
+        "resource": "pokemon",
+        "x-normalizer": {
+            "seen-data": true
+        }
     },
     "berry": {
         "columns": {
@@ -55,7 +58,48 @@
         },
         "write_disposition": "append",
         "name": "berry",
-        "resource": "berry"
+        "resource": "berry",
+        "x-normalizer": {
+            "seen-data": true
+        }
+    },
+    "_dlt_version": {
+        "name": "_dlt_version",
+        "columns": {
+            "version": {
+                "name": "version",
+                "data_type": "bigint",
+                "nullable": false
+            },
+            "engine_version": {
+                "name": "engine_version",
+                "data_type": "bigint",
+                "nullable": false
+            },
+            "inserted_at": {
+                "name": "inserted_at",
+                "data_type": "timestamp",
+                "nullable": false
+            },
+            "schema_name": {
+                "name": "schema_name",
+                "data_type": "text",
+                "nullable": false
+            },
+            "version_hash": {
+                "name": "version_hash",
+                "data_type": "text",
+                "nullable": false
+            },
+            "schema": {
+                "name": "schema",
+                "data_type": "text",
+                "nullable": false
+            }
+        },
+        "write_disposition": "skip",
+        "resource": "_dlt_version",
+        "description": "Created by DLT. Tracks schema updates"
     },
     "location": {
         "columns": {
@@ -84,10 +128,48 @@
         },
         "write_disposition": "append",
         "name": "location",
-        "resource": "location"
+        "resource": "location",
+        "x-normalizer": {
+            "seen-data": true
+        }
     },
     "_dlt_pipeline_state": {
         "columns": {
+            "version": {
+                "name": "version",
+                "data_type": "bigint",
+                "nullable": false
+            },
+            "engine_version": {
+                "name": "engine_version",
+                "data_type": "bigint",
+                "nullable": false
+            },
+            "pipeline_name": {
+                "name": "pipeline_name",
+                "data_type": "text",
+                "nullable": false
+            },
+            "state": {
+                "name": "state",
+                "data_type": "text",
+                "nullable": false
+            },
+            "created_at": {
+                "name": "created_at",
+                "data_type": "timestamp",
+                "nullable": false
+            },
+            "version_hash": {
+                "name": "version_hash",
+                "data_type": "text",
+                "nullable": true
+            },
+            "_dlt_load_id": {
+                "name": "_dlt_load_id",
+                "data_type": "text",
+                "nullable": false
+            },
             "_dlt_id": {
                 "name": "_dlt_id",
                 "data_type": "text",
@@ -99,6 +181,42 @@
         "write_disposition": "append",
         "file_format": "preferred",
         "name": "_dlt_pipeline_state",
-        "resource": "_dlt_pipeline_state"
+        "resource": "_dlt_pipeline_state",
+        "x-normalizer": {
+            "seen-data": true
+        }
+    },
+    "_dlt_loads": {
+        "name": "_dlt_loads",
+        "columns": {
+            "load_id": {
+                "name": "load_id",
+                "data_type": "text",
+                "nullable": false
+            },
+            "schema_name": {
+                "name": "schema_name",
+                "data_type": "text",
+                "nullable": true
+            },
+            "status": {
+                "name": "status",
+                "data_type": "bigint",
+                "nullable": false
+            },
+            "inserted_at": {
+                "name": "inserted_at",
+                "data_type": "timestamp",
+                "nullable": false
+            },
+            "schema_version_hash": {
+                "name": "schema_version_hash",
+                "data_type": "text",
+                "nullable": true
+            }
+        },
+        "write_disposition": "skip",
+        "resource": "_dlt_loads",
+        "description": "Created by DLT. Tracks completed loads"
     }
 }
```

##### load/loaded/1751953713.128814/load_package_state.json

`extract()`ã€`normalize()` æ™‚ç‚¹ã¨åŒã˜ã§ã™ã€‚

#### .insert_values ãƒ•ã‚¡ã‚¤ãƒ«

`normalize()` ã§ç”Ÿæˆã•ã‚ŒãŸã‚‚ã®ã¨åŒã˜ã§ã™ã€‚

# ãŠã‚ã‚Šã«
ã¾ã ã€ã‚¹ãƒƒã‚­ãƒªã—ãªã„éƒ¨åˆ†ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€dlt ã¯ã€Python ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã—ã‹ãªã„ã®ã§ã€å®Ÿè¡Œæ™‚ã«ã€ãƒ‡ãƒãƒƒã‚¬ãƒ¼ã§å†…éƒ¨ã¾ã§è¿½è·¡ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚å‰å›ã®è¨˜äº‹ã®ã‚ˆã†ã«ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ã¦ã€ä»Šå›ã®è¨˜äº‹ã§å–ã‚Šä¸Šã’ãŸãƒ­ãƒ¼ã‚«ãƒ«ãƒã‚·ãƒ³ã®ä½œæ¥­ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã‚‚è¦‹ãªãŒã‚‰ã€ãƒ‡ãƒãƒƒã‚¬ãƒ¼ã§è¿½è·¡ã™ã‚‹ã¨ã ã‚“ã ã‚“ã‚ã‹ã£ãŸæ°—åˆ†ã«ãªã‚Œã¾ã™ã€‚
