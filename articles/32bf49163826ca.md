---
title: "NestJSã§RESTï¼ˆãã®ï¼’ï¼‰"
emoji: "ğŸ¦"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["nestjs", "rest", "postgresql", "nodejs", "typescript"]
published: false
publication_name: "robon"
---

# å‰å›ã¾ã§

https://zenn.dev/robon/articles/76d4ec767b72ae

NestJSã®CLIã§Webã‚µãƒ¼ãƒãƒ¼éƒ¨åˆ†ã¯ã§ãã¡ã‚ƒã„ã¾ã—ãŸã€‚ğŸ‘

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨ç¹‹ã
## TypeORMï¼ˆã¨Postgresï¼‰ã‚’å°å…¥
æœ¬å®¶ã‚’å«ã‚ã¦ã€mysqlãŒå¤šã„ã‚ˆã†ãªæ°—ãŒã—ã¾ã™ãŒã€ä»Šå›ã¯ã€åˆ¥ä»¶ã§Postgesã‚’ä½¿ã£ã¦ã„ãŸã®ã§ã€Postgresã§ã‚„ã‚Šã¾ã™ã€‚

```bash
$ npm install --save @nestjs/typeorm typeorm pg
```

## customersã‚’å®Ÿè£…ã™ã‚‹
ã¾ãšã€ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œã‚Šã¾ã™ã€‚

```sql
CREATE TABLE CUSTOMER (
    CUSTOMER_ID int,
    NAME text,
    ADDRESS text,
    CONSTRAINT PK_CUSTOMER PRIMARY KEY(CUSTOMER_ID)
);
```
ã“ã“ã§è‹±å¤§æ–‡å­—ã§æ›¸ã„ã¦ã‚‚ã€Postgresã•ã‚“ã¯è‹±å°æ–‡å­—ã§èªè­˜ã•ã‚Œã¦ã„ã¦ã€å¾Œã§ãƒãƒã‚Šã¾ã™ã€‚

### TypeORMã®è¨­å®š
TypeORMã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®è¨­å®šã‚’ã—ã¤ã¤ã€NestJSã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã—ã¦AppModuleã«çµ„ã¿è¾¼ã¿ã¾ã™ã€‚

```diff ts:src/app.modules.ts
@@ -1,10 +1,25 @@
 import { Module } from '@nestjs/common';
+import { TypeOrmModule } from '@nestjs/typeorm';
 import { AppController } from './app.controller';
 import { AppService } from './app.service';
 import { CustomersModule } from './customers/customers.module';
+import { Customer } from './customers/entities/customer.entity';
 
 @Module({
-  imports: [CustomersModule],
+  imports: [
+    CustomersModule,
+    TypeOrmModule.forRoot({
+      type: 'postgres',
+      host: 'â– â– â– â– ',
+      port: 5432,
+      username: 'â– â– â– â– ',
+      password: 'â– â– â– â– ',
+      database: 'postgres',
+      entities: [Customer],
+      logging: true,
+      synchronize: false,
+    }),
+  ],
   controllers: [AppController],
   providers: [AppService],
 })
```

loggingã‚’trueã«ã—ã¦ãŠãã¨ãƒãƒã£ãŸã¨ãã«åŠ©ã‹ã‚Šã¾ã™ã€‚ï¼ˆãƒãƒã£ã¦ã‹ã‚‰trueã«ã—ã¾ã—ãŸï¼‰
è¨­å®šãŒã“ã‚“ãªæ„Ÿã˜ã ã¨ä¸¸è¦‹ãˆãªã®ã§ã€ã‚ã¨ã§ãªã‚“ã¨ã‹ã—ã¾ã™ã€‚

### ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®è¨­å®š
Javaç•Œéšˆã§ãŠé¦´æŸ“ã¿ã®é¦™ã‚ŠãŒã—ã¾ã™ã€‚

```diff ts:src/customers/entities/customer.entity.ts
@@ -1 +1,13 @@
-export class Customer {}
+import { Entity, Column, PrimaryColumn } from 'typeorm';
+
+@Entity()
+export class Customer {
+  @PrimaryColumn({ name: 'customer_id' })
+  customerId: number;
+
+  @Column()
+  name: string;
+
+  @Column()
+  address: string;
+}
```

ã“ã“ã§ãƒãƒã‚Šã¾ã—ãŸã€‚TypeORMã•ã‚“ã¯ã€ãƒ†ãƒ¼ãƒ–ãƒ«åã‚„ã‚«ãƒ©ãƒ åã‚’ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆã§å›²ã‚“ã§æ¸¡ã—ã¦ã¾ã™ã€‚SQLã®ä¸–ç•Œã§ã¯å¤§æ–‡å­—å°æ–‡å­—ã®åŒºåˆ¥ã¯ã—ãªã„ã®ã§ã™ãŒã€ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆã§å›²ã‚€ã¨æ›¸ã‹ã‚ŒãŸã¨ãŠã‚Šã®æ–‡å­—åˆ—ã¨ã—ã¦ãƒãƒƒãƒãƒ³ã‚°ã™ã‚‹ãã†ã§ã™ã€‚
ãªã®ã§ã€ä¸Šã§ã€@PrimaryColumn({ name: 'customer_id' })ã¨ã—ã¦ã„ã‚‹ã¨ã“ã‚ã‚’'CUSTOMER_ID'ã¨ã—ã¦ã—ã¾ã†ã¨ã€ã€Œãã‚“ãªã‚«ãƒ©ãƒ ã¯ã‚ã‚Šã¾ã›ã‚“ã€ã®ä¸€ç‚¹å¼µã‚Šã§ã™ã€‚

ä»Šå›ã«é™ã‚‰ãšã€å®Ÿã¯ã€ORãƒãƒƒãƒ‘ãƒ¼å«Œã„ã§ã™ï¼ˆç¬‘ï¼‰ã€‚ä»Šå›ã¯ã€logging: trueã«ã—ã¦ã€è¡¨ç¤ºã•ã‚ŒãŸSQLã‚’ç›´å©ãã—ãªã„ã¨è§£æ±ºã§ãã¾ã›ã‚“ã§ã—ãŸã€‚ã€Œãªã€‚ã ã‹ã‚‰æœ€åˆã‹ã‚‰ä¿ºã«SQLæ›¸ã‹ã›ã‚ã‚ˆã€

### DTOã®è¨­å®š
å‰å›ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã®JSONã«ãªã‚‹ã‚ˆã†ã«å®šç¾©ã—ã¾ã™ã€‚

```diff ts:src/customers/dto/create-customer.dto.ts
@@ -1 +1,5 @@
-export class CreateCustomerDto {}
+export class CreateCustomerDto {
+  customerId: number;
+  name: string;
+  address: string;
+}
```

Updateç”¨ã®ã‚¯ãƒ©ã‚¹ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã—ãªãã¦ã‚‚å¤§ä¸ˆå¤«ã§ã™ã€‚

```src/customers/dto/update-customer.dto.ts
export class UpdateCustomerDto extends PartialType(CreateCustomerDto) {}
```

PartialTypeã£ã¦ä½•ï¼Ÿã£ã¦ãªã‚Šã¾ã™ã‚ˆã­ã€‚

> The PartialType() function returns a type (class) with all the properties of the input type set to optional. 

https://docs.nestjs.com/openapi/mapped-types

ã‚€ã‚€ã‚€ã€‚ã¨ã„ã†ã“ã¨ã§ã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’é¡ã‚‹ã¨

```typescript/lib/lib.es5.d.ts
/**
 * Make all properties in T optional
 */
type Partial<T> = {
    [P in keyof T]?: T[P];
};
```

ã¨ã„ã†ã“ã¨ã§ã€?ãŒä»˜ã„ã¦ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ã€‚ä½œæˆã®æ™‚ã¯å…¨éƒ¨ã ã‘ã©ã€æ›´æ–°ã®æ™‚ã¯æ¬ ã‘ã¦ã‚‚ã„ã„ã€‚ã¨ã„ã†ã®ãŒã§ãã‚‹ã®ã­ã€‚TypeScriptã¯æ·±ã„ã€‚

# æ¬¡å›ã¯

serviceã‹ã‚‰ã‚„ã‚Šã¾ã™ã€‚

https://zenn.dev/robon/articles/f5e5907aa871a5

