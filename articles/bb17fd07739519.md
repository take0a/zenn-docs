---
title: "FastAPIでREST（その２）"
emoji: "🏎"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["fastapi", "rest", "postgresql", "python", "スキーマ駆動"]
published: false
publication_name: "robon"
---

# 前回まで

https://zenn.dev/robon/articles/aa7ba513b3bdb3

FastAPIも導入すれば、とりあえず動くところまでは簡単でした。

# 設計と実装
## プロジェクトの構造はどうする？

NestJSはCLIでひな型の自動生成をしてくれたので、それに乗っかることにしました。スキーマ単位の構造は、スキーマ駆動でマイクロサービスな感じで、これからはこういう構造になっていくのかなぁと思いました。

で、FastAPIです。公式では、どうやらレイヤ構造を推奨しているようです。

https://fastapi.tiangolo.com/tutorial/bigger-applications/

多くの記事で上記に近い構造が紹介されていましたが、ここはNestJSのようにスキーマ単位の構造を採用してみようと思います。ディレクトリがスキーマ名になり、機能名がファイル名になるだけなので、縦と横をひっくり返したようになるだけです。

```bash
$ tree src -I __pycache__
src
├── config.py
├── customers
│   ├── __init__.py
│   ├── models.py
│   ├── router.py
│   ├── schemas.py
│   └── service.py
├── database.py
├── __init__.py
├── main.py
├── orders
└── products
```

最初に実装するcustomersと同様にordersとproductsにも実装していきます。

## SQLAlchemy & Postgres

折角なので、データベースアクセスも非同期にしてみます。

```bash
(venv) $ pip install sqlalchemy
(venv) $ pip install asyncpg
```


