---
title: "å…¬å¼ã‚µãƒ³ãƒ—ãƒ«ã‚’å…¬å¼Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã«å…¥ã‚Œã‚‹MySQLç·¨ï¼‰"
emoji: "ğŸ¬"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["docker", "mysql", "sql"]
published: false
publication_name: "robon"
---

# ã¯ã˜ã‚ã«
ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒæ¬²ã—ããªã£ãŸã®ã§ã™ãŒã€æœ€è¿‘ã¯è¦‹ã‹ã‘ãªã„ã‚ˆã†ãªæ°—ãŒã—ã¾ã™ã€‚
æ˜”ã€…ã¯ã€scott/tiger ã§ã¤ãªã„ã§ EMP ãƒ†ãƒ¼ãƒ–ãƒ«ã§ç·´ç¿’ã™ã‚‹ã®ãŒãŠç´„æŸã§ã—ãŸãŒâ€¦ã€‚
èª¿ã¹ã¦ã¿ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚

æœ€åˆã¯ã€ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®å ´æ‰€ã ã‘ã®å‚™å¿˜éŒ²ã«ã—ã‚ˆã†ã¨æ€ã£ãŸã®ã§ã™ãŒã€ã¡ã‚‡ã£ã¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½¿ã£ãŸãƒ‡ãƒ¢ã¨ã‹ãƒ†ã‚¹ãƒˆãŒå¿…è¦ã«ãªã£ãŸã®ã§ã€ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å…¥ã‚Šã® Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œã£ã¦ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œã‚‹ææ–™ã‚‚ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚‚å…¬é–‹ã—ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚

# MySQL ç·¨
MySQL ã«ã¯ä¼¼ãŸã‚ˆã†ãªè¨˜äº‹ãŒã„ãã¤ã‹ã‚ã‚Šã¾ã™ï¼ˆè‹¦ç¬‘ï¼‰ã€‚
åŸºæœ¬çš„ã«ã¯ã€ä»¥å‰ã® PostgreSQL ã®æ´¾ç”Ÿå½¢ãªã®ã§ã€åŒã˜ã§ã™ã€‚
https://zenn.dev/robon/articles/6071ebdff6e2f5

## å…¬å¼ Docker ã‚¤ãƒ¡ãƒ¼ã‚¸
ã‚ªãƒ•ã‚£ã‚·ãƒ£ãƒ«ã‚¤ãƒ¡ãƒ¼ã‚¸ã¯ã€ä»¥ä¸‹ã«ã‚ã‚Šã¾ã™ã€‚
https://hub.docker.com/_/mysql

ã“ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã—ã¦ã„ã‚‹ã®ãŒã€ä»¥ä¸‹ã§ã™ã€‚
https://github.com/docker-library/mysql

ã“ã®ã‚ªãƒ•ã‚£ã‚·ãƒ£ãƒ«ã‚¤ãƒ¡ãƒ¼ã‚¸ã® `Initializing a fresh instance` ã«æ›¸ã‹ã‚Œã¦ã„ã¾ã™ã€‚

> When a container is started for the first time, a new database with the specified name will be created and initialized with the provided configuration variables. Furthermore, it will execute files with extensions .sh, .sql and .sql.gz that are found in /docker-entrypoint-initdb.d. Files will be executed in alphabetical order. You can easily populate your mysql services by mounting a SQL dump into that directoryâ  and provide custom imagesâ  with contributed data. SQL files will be imported by default to the database specified by the MYSQL_DATABASE variable.

ãªã®ã§ã€ã“ã‚Œã¾ã§åŒæ§˜ã€`.sql` ã‚„ `.sh` ã‚’ `/docker-entrypoint-initdb.d` ã«ç½®ã„ã¦ãŠã‘ã°è‰¯ã„ã¨ã„ã†ã“ã¨ã§ã™ã€‚

## å…¬å¼ã‚µãƒ³ãƒ—ãƒ«
å…¬å¼ã‚µãƒ³ãƒ—ãƒ«ã¯ã€ä»¥ä¸‹ã«ã‚ã‚Šã¾ã—ãŸã€‚
https://dev.mysql.com/doc/index-other.html

ä»Šå›ã¯ã€`sakila database` ã‚’çµ„ã¿è¾¼ã‚€ã“ã¨ã«ã—ã¾ã™ã€‚

## Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œã‚‹
æœ¬å½“ã¯ã€ä½œã‚‰ãªãã¦ã‚‚ã€`/docker-entrypoint-initdb.d` ã‚’ `-v` ã§ãƒã‚¦ãƒ³ãƒˆã™ã‚Œã°çµ‚äº†ãªã‚“ã ã‘ã©ã€çµ„ã¿è¾¼ã‚“ã§ã—ã¾ã£ãŸæ–¹ãŒæ¥½ãªã‚“ã˜ã‚ƒãªã„ã®ï¼Ÿã¨ã„ã†ã“ã¨ã§ä½œã‚Šã¾ã™ã€‚

### SQLãƒ•ã‚¡ã‚¤ãƒ«
`sakila-db.tar.gz` ã‚’è§£å‡ã—ã¦ã€`sakila-schema.sql` ã¨ `sakila-data.sql` ã‚’ä½¿ã„ã¾ã™ã€‚
Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã®å¤§ãã•ã®å•é¡Œã‚‚ã‚ã‚‹ã®ã§ã€build ã™ã‚‹éš›ã¯ã€`.sql.gz` ã«åœ§ç¸®ã—ã¾ã™ã€‚

### Dockerfile
```dockerfile: Dockerfile
FROM mysql
COPY ./sakila-db/sakila-schema.sql.gz /docker-entrypoint-initdb.d/01.sql.gz
COPY ./sakila-db/sakila-data.sql.gz /docker-entrypoint-initdb.d/02.sql.gz
```
ãã®ã¾ã‚“ã¾ã§ã™ã€‚
ã‚³ãƒ”ãƒ¼å…ˆã‚’ `01.sql.gz` ã¨ `02.sql.gz` ã«ã—ã¦ã„ã‚‹ã®ã¯ã€ã‚ªãƒ•ã‚£ã‚·ãƒ£ãƒ«ã‚¤ãƒ¡ãƒ¼ã‚¸ã«æ›¸ã„ã¦ã‚ã£ãŸ `Files will be executed in alphabetical order.` å¯¾ç­–ã§ã™ã€‚

### Makefile
```makefile: Makefile
.PHONY: build run push clean

IMAGE=docker.io/take0a/mysql-sakila
CONTAINER=mysql01
PASSWORD=password

build: clean
	gzip -k sakila-db/*.sql 
	docker build . -t $(IMAGE) --no-cache

run:
	docker run --name $(CONTAINER) -dit -e MYSQL_ROOT_PASSWORD=$(PASSWORD) $(IMAGE)
	docker exec -it $(CONTAINER) /usr/bin/mysql -p

push:
	docker push $(IMAGE)

clean:
	docker container rm $(CONTAINER) -f
	docker image rm $(IMAGE) -f
	rm -f sakila-db/*.sql.gz
```
ã“ã‚“ãªæ„Ÿã˜ã«ã—ã¦ãŠãã¨ã€ã‚³ãƒãƒ³ãƒ‰ã‚’å¿˜ã‚Œã¦ã€Œã‚ã‚ã‚ã€ã—ãªãã¦ã™ã¿ã¾ã™ã€‚

## Docker ã‚¤ãƒ¡ãƒ¼ã‚¸
ä»¥ä¸‹ã§å…¬é–‹ã—ã¾ã—ãŸã€‚
https://hub.docker.com/r/take0a/mysql-sakila

`docker pull take0a/mysql-sakila` ã§ pull ã§ãã¾ã™ã€‚

## GitHub ãƒªãƒã‚¸ãƒˆãƒª
ä»¥ä¸‹ã§å…¬é–‹ã—ã¾ã—ãŸã€‚
https://github.com/take0a/docker-library/tree/main/mysql

ä»–ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚‚ã®ã‚‚å…¬é–‹ã—ãŸã‚‰ã€å°‘ã—ãã‚Œã„ã«ã—ã¦ãŠãã¾ã™ã€‚

# ãŠã‚ã‚Šã«
ã‚„ã¯ã‚Šã€ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¯å¿…è¦ã§ã™ã‚ˆã­ã€‚
