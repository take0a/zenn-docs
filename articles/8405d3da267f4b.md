---
title: "dgã§å§‹ã‚ã‚‹æ–°dagster"
emoji: "ğŸ™"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["python", "dagster", "uv", "dbt", "duckdb"]
published: true
publication_name: "robon"
---

# ã¯ã˜ã‚ã«

dagster ã‚‚ã‚¦ã‚©ãƒƒãƒã—ã¦ã¾ã—ã¦ã€[ETL pipeline tutorial](https://docs.dagster.io/etl-pipeline-tutorial/) ã‚‚ã‚„ã£ã¦ã¿ãŸã®ã§ã™ãŒã€ã‚ã‚‹æ—¥ã€ãµã¨è¦‹ã‚‹ã¨è¦‹æ…£ã‚Œãªã„ã‚‚ã®ãŒâ€¦

https://docs.dagster.io/guides/labs/components/components-etl-pipeline-tutorial

ã¨ã„ã†ã“ã¨ã§ã€ã“ã¡ã‚‰ã‚’ã‚„ã£ã¦ã„ãã¾ã™ã€‚

:::message alert
ã“ã®æ©Ÿèƒ½ã¯ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ®µéšã«ã‚ã‚Šã€ç¾åœ¨é–‹ç™ºä¸­ã§ã™ã€‚å¤§å¹…ã«å¤‰æ›´ã•ã‚Œã‚‹ã‹ã€å®Œå…¨ã«å‰Šé™¤ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚å®Ÿç¨¼åƒç’°å¢ƒã§ã®ä½¿ç”¨ã«ã¯å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚ã¨ã®ã“ã¨ã§ã™ã€‚
:::

# ã‚„ã£ã¦ã¿ãŸ

## [äº‹å‰æº–å‚™](https://docs.dagster.io/guides/labs/components/components-etl-pipeline-tutorial#1-install-project-dependencies)

uv ã¯ã€[ã“ã“](https://docs.astral.sh/uv/getting-started/installation/)è¦‹ã¦ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã—ã‚‡ã†ã€‚ï¼ˆåˆ¥ç›®çš„ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ï¼‰

```
$ curl -LsSf https://astral.sh/uv/install.sh | sh
```

dg ã¯ã€[ã“ã“](https://docs.dagster.io/guides/labs/dg/)è¦‹ã¦ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã—ã‚‡ã†ã€‚

```
$ uv --version
uv 0.6.10
$ uv tool install dagster-dg
Resolved 43 packages in 645ms
Prepared 13 packages in 43ms
Installed 43 packages in 60ms
 + annotated-types==0.7.0
:
 + yaspin==3.1.0
Installed 1 executable: dg
$ dg --version
dg, version 0.26.9
```

duckdb ã¯ã€[ã“ã“](https://duckdb.org/docs/installation/)è¦‹ã¦ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã—ã‚‡ã†ã€‚ï¼ˆåˆ¥ç›®çš„ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ï¼‰

```
$ curl https://install.duckdb.org | sh
```

## [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã‚‹](https://docs.dagster.io/guides/labs/components/components-etl-pipeline-tutorial#2-scaffold-a-new-project)

```
$ dg scaffold project jaffle-platform
Creating a Dagster project at /home/ec2-user/work/mds/jaffle-platform.
Scaffolded files for Dagster project at /home/ec2-user/work/mds/jaffle-platform.
Using CPython 3.12.9
Creating virtual environment at: .venv
Resolved 74 packages in 273ms
      Built jaffle-platform @ file:///home/ec2-user/work/mds/jaffle-platform
Prepared 38 packages in 599ms
Installed 68 packages in 84ms
 + alembic==1.15.2
:
 + yarl==1.19.0
Using /home/ec2-user/work/mds/jaffle-platform/.venv/bin/dagster-components
```

## [Slingã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå‹ã‚’ç’°å¢ƒã«è¿½åŠ ã™ã‚‹](https://docs.dagster.io/guides/labs/components/components-etl-pipeline-tutorial#1-add-the-sling-component-type-to-your-environment)

Sling ã¯ã€[ã“ã¡ã‚‰](https://slingdata.io/)ã§ã™ã­ã€‚dagster ã¨ã¯[ä»²è‰¯ã—](https://dagster.io/blog/sling-out-your-etl-provider-with-embedded-elt)ã®ã‚ˆã†ã§ã™ã€‚

```
$ cd jaffle-platform
$ dg list component-type
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ Component Type                                              â”ƒ Summary                                                                 â”ƒ
â”¡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”©
â”‚ dagster.components.DefinitionsComponent                     â”‚ An arbitrary set of dagster definitions.                                â”‚
â”‚ dagster.components.DefsFolderComponent                      â”‚ A folder containing multiple submodules.                                â”‚
â”‚ dagster.components.PipesSubprocessScriptCollectionComponent â”‚ Assets that wrap Python scripts executed with Dagster's                 â”‚
â”‚                                                             â”‚ PipesSubprocessClient.                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
$ uv add dagster-sling
Resolved 81 packages in 1.25s
      Built jaffle-platform @ file:///home/ec2-user/work/mds/jaffle-platform
Prepared 4 packages in 1.13s
Uninstalled 1 package in 0.18ms
Installed 4 packages in 5ms
 + dagster-sling==0.26.9
 ~ jaffle-platform==0.1.0 (from file:///home/ec2-user/work/mds/jaffle-platform)
 + sling==1.4.4
 + sling-linux-amd64==1.4.4
$ dg list component-type
Using /home/ec2-user/work/mds/jaffle-platform/.venv/bin/dagster-components
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ Component Type                                              â”ƒ Summary                                                                 â”ƒ
â”¡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”©
â”‚ dagster.components.DefinitionsComponent                     â”‚ An arbitrary set of dagster definitions.                                â”‚
â”‚ dagster.components.DefsFolderComponent                      â”‚ A folder containing multiple submodules.                                â”‚
â”‚ dagster.components.PipesSubprocessScriptCollectionComponent â”‚ Assets that wrap Python scripts executed with Dagster's                 â”‚
â”‚                                                             â”‚ PipesSubprocessClient.                                                  â”‚
â”‚ dagster_sling.SlingReplicationCollectionComponent           â”‚ Expose one or more Sling replications to Dagster as assets.             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

## [Slingã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œã‚‹](https://dagster.io/blog/sling-out-your-etl-provider-with-embedded-elt)

```
$ dg scaffold 'dagster_sling.SlingReplicationCollectionComponent' ingest_files
Using /home/ec2-user/work/mds/jaffle-platform/.venv/bin/dagster-components
$ tree
.
â”œâ”€â”€ jaffle_platform_tests
â”‚   â””â”€â”€ __init__.py
â”œâ”€â”€ pyproject.toml
â”œâ”€â”€ src
â”‚   â””â”€â”€ jaffle_platform
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ __pycache__
â”‚       â”‚   â””â”€â”€ __init__.cpython-312.pyc
â”‚       â”œâ”€â”€ definitions.py
â”‚       â”œâ”€â”€ defs
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â””â”€â”€ ingest_files
â”‚       â”‚       â”œâ”€â”€ component.yaml
â”‚       â”‚       â””â”€â”€ replication.yaml
â”‚       â””â”€â”€ lib
â”‚           â”œâ”€â”€ __init__.py
â”‚           â””â”€â”€ __pycache__
â”‚               â””â”€â”€ __init__.cpython-312.pyc
â””â”€â”€ uv.lock
```
```yaml: src/jaffle_platform/defs/ingest_files/component.yaml
type: dagster_sling.SlingReplicationCollectionComponent

attributes:
  replications:
  - path: replication.yaml
```

## [DuckDB ã‚’è¨­å®šã™ã‚‹](https://docs.dagster.io/guides/labs/components/components-etl-pipeline-tutorial#4-set-up-duckdb)

```
$ uv run sling conns set DUCKDB type=duckdb instance=/tmp/jaffle_platform.duckdb
6:41AM INF connection `DUCKDB` has been set in /home/ec2-user/.sling/env.yaml. Please test with `sling conns test DUCKDB`
$ uv run sling conns test DUCKDB
6:42AM INF downloading duckdb 1.1.3 for linux/amd64
6:42AM INF success!
```

## [Slingã‚½ãƒ¼ã‚¹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰](https://docs.dagster.io/guides/labs/components/components-etl-pipeline-tutorial#5-download-files-for-sling-source)

```
$ curl -O https://raw.githubusercontent.com/dbt-labs/jaffle-shop-classic/refs/heads/main/seeds/raw_customers.csv &&
curl -O https://raw.githubusercontent.com/dbt-labs/jaffle-shop-classic/refs/heads/main/seeds/raw_orders.csv &&
curl -O https://raw.githubusercontent.com/dbt-labs/jaffle-shop-classic/refs/heads/main/seeds/raw_payments.csv
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  1302  100  1302    0     0   4387      0 --:--:-- --:--:-- --:--:--  4398
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  2723  100  2723    0     0   8544      0 --:--:-- --:--:-- --:--:--  8562
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  2560  100  2560    0     0   8374      0 --:--:-- --:--:-- --:--:--  8366
```

```yaml: src/jaffle_platform/defs/ingest_files/replication.yaml
source: LOCAL
target: DUCKDB

defaults:
  mode: full-refresh
  object: "{stream_table}"

streams:
  file://raw_customers.csv:
    object: "main.raw_customers"
  file://raw_orders.csv:
    object: "main.raw_orders"
  file://raw_payments.csv:
    object: "main.raw_payments"
```

```yaml: src/jaffle_platform/defs/ingest_files/component.yaml
type: dagster_sling.SlingReplicationCollectionComponent

attributes:
  sling:
    connections:
      - name: DUCKDB
        type: duckdb
        instance: /tmp/jaffle_platform.duckdb
  replications:
    - path: replication.yaml
```

## [UIã§ã‚¢ã‚»ãƒƒãƒˆã®è¡¨ç¤ºã¨ãƒãƒ†ãƒªã‚¢ãƒ©ã‚¤ã‚º](https://docs.dagster.io/guides/labs/components/components-etl-pipeline-tutorial#6-view-and-materialize-assets-in-the-dagster-ui)

```
$ dg dev
All components validated successfully.
Using /home/ec2-user/work/mds/jaffle-platform/.venv/bin/dagster
2025-04-08 06:57:04 +0000 - dagster - INFO - Using temporary directory /home/ec2-user/work/mds/jaffle-platform/.tmp_dagster_home_icbv7wsl for storage. This will be removed when dagster dev exits.
2025-04-08 06:57:04 +0000 - dagster - INFO - To persist information across sessions, set the environment variable DAGSTER_HOME to a directory to use.
2025-04-08 06:57:05 +0000 - dagster - INFO - Launching Dagster services...
2025-04-08 06:57:08 +0000 - dagster.daemon - INFO - Instance is configured with the following daemons: ['AssetDaemon', 'BackfillDaemon', 'QueuedRunCoordinatorDaemon', 'SchedulerDaemon', 'SensorDaemon']
2025-04-08 06:57:08 +0000 - dagster-webserver - INFO - Serving dagster-webserver on http://127.0.0.1:3000 in process 56538
2025-04-08 06:57:23 +0000 - dagster.daemon.QueuedRunCoordinatorDaemon - INFO - Priority sorting and checking tag concurrency limits for queued runs.
2025-04-08 06:57:24 +0000 - dagster.daemon.QueuedRunCoordinatorDaemon - INFO - Launched 1 runs.
```

```
$ ~/.duckdb/cli/latest/duckdb /tmp/jaffle_platform.duckdb -c "SELECT * FROM raw_customers LIMIT 5;"
â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  id   â”‚ first_name â”‚ last_name â”‚ _sling_loaded_at â”‚
â”‚ int32 â”‚  varchar   â”‚  varchar  â”‚      int64       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     1 â”‚ Michael    â”‚ P.        â”‚       1744095445 â”‚
â”‚     2 â”‚ Shawn      â”‚ M.        â”‚       1744095445 â”‚
â”‚     3 â”‚ Kathleen   â”‚ P.        â”‚       1744095445 â”‚
â”‚     4 â”‚ Jimmy      â”‚ C.        â”‚       1744095445 â”‚
â”‚     5 â”‚ Katherine  â”‚ R.        â”‚       1744095445 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## [ã‚µãƒ³ãƒ—ãƒ«dbtãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚³ãƒ”ãƒ¼](https://docs.dagster.io/guides/labs/components/components-etl-pipeline-tutorial#1-clone-a-sample-dbt-project-from-github)

```
$ git clone --depth=1 https://github.com/dagster-io/jaffle-platform.git dbt && rm -rf dbt/.git
Cloning into 'dbt'...
remote: Enumerating objects: 15, done.
remote: Counting objects: 100% (15/15), done.
remote: Compressing objects: 100% (11/11), done.
Receiving objects: 100% (15/15), done.
remote: Total 15 (delta 2), reused 15 (delta 2), pack-reused 0 (from 0)
Resolving deltas: 100% (2/2), done.
$ tree
.
â”œâ”€â”€ dbt
â”‚   â””â”€â”€ jdbt
â”‚       â”œâ”€â”€ README.md
â”‚       â”œâ”€â”€ dbt_project.yml
â”‚       â”œâ”€â”€ models
â”‚       â”‚   â”œâ”€â”€ customers.sql
â”‚       â”‚   â”œâ”€â”€ orders.sql
â”‚       â”‚   â”œâ”€â”€ sources.yml
â”‚       â”‚   â””â”€â”€ stg
â”‚       â”‚       â”œâ”€â”€ stg_customers.sql
â”‚       â”‚       â”œâ”€â”€ stg_orders.sql
â”‚       â”‚       â””â”€â”€ stg_payments.sql
â”‚       â””â”€â”€ profiles.yml
â”œâ”€â”€ jaffle_platform_tests
â”‚   â””â”€â”€ __init__.py
â”œâ”€â”€ pyproject.toml
â”œâ”€â”€ raw_customers.csv
â”œâ”€â”€ raw_orders.csv
â”œâ”€â”€ raw_payments.csv
â”œâ”€â”€ src
â”‚   â””â”€â”€ jaffle_platform
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ __pycache__
â”‚       â”‚   â”œâ”€â”€ __init__.cpython-312.pyc
â”‚       â”‚   â””â”€â”€ definitions.cpython-312.pyc
â”‚       â”œâ”€â”€ definitions.py
â”‚       â”œâ”€â”€ defs
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ __pycache__
â”‚       â”‚   â”‚   â””â”€â”€ __init__.cpython-312.pyc
â”‚       â”‚   â””â”€â”€ ingest_files
â”‚       â”‚       â”œâ”€â”€ component.yaml
â”‚       â”‚       â””â”€â”€ replication.yaml
â”‚       â””â”€â”€ lib
â”‚           â”œâ”€â”€ __init__.py
â”‚           â””â”€â”€ __pycache__
â”‚               â””â”€â”€ __init__.cpython-312.pyc
â””â”€â”€ uv.lock
```

## [dbtãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«](https://docs.dagster.io/guides/labs/components/components-etl-pipeline-tutorial#2-install-the-dbt-project-component-type)

```
$ uv add dagster-dbt dbt-duckdb
Resolved 120 packages in 802ms
      Built jaffle-platform @ file:///home/ec2-user/work/mds/jaffle-platform
Prepared 7 packages in 219ms
Uninstalled 1 package in 0.15ms
Installed 40 packages in 76ms
 + agate==1.9.1
:
 + zipp==3.21.0
$ dg list component-type
Using /home/ec2-user/work/mds/jaffle-platform/.venv/bin/dagster-components
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ Component Type                                              â”ƒ Summary                                                                        â”ƒ
â”¡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”©
â”‚ dagster.components.DefinitionsComponent                     â”‚ An arbitrary set of dagster definitions.                                       â”‚
â”‚ dagster.components.DefsFolderComponent                      â”‚ A folder containing multiple submodules.                                       â”‚
â”‚ dagster.components.PipesSubprocessScriptCollectionComponent â”‚ Assets that wrap Python scripts executed with Dagster's PipesSubprocessClient. â”‚
â”‚ dagster_dbt.DbtProjectComponent                             â”‚ Expose a DBT project to Dagster as a set of assets.                            â”‚
â”‚ dagster_sling.SlingReplicationCollectionComponent           â”‚ Expose one or more Sling replications to Dagster as assets.                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## [dbtã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’æ§‹ç¯‰](https://docs.dagster.io/guides/labs/components/components-etl-pipeline-tutorial#3-scaffold-a-new-instance-of-the-dbt-project-component)

```
$ dg scaffold dagster_dbt.DbtProjectComponent jdbt --project-path dbt/jdbt
Using /home/ec2-user/work/mds/jaffle-platform/.venv/bin/dagster-components
$ tree
.
â”œâ”€â”€ dbt
â”‚   â””â”€â”€ jdbt
â”‚       â”œâ”€â”€ README.md
â”‚       â”œâ”€â”€ dbt_project.yml
â”‚       â”œâ”€â”€ models
â”‚       â”‚   â”œâ”€â”€ customers.sql
â”‚       â”‚   â”œâ”€â”€ orders.sql
â”‚       â”‚   â”œâ”€â”€ sources.yml
â”‚       â”‚   â””â”€â”€ stg
â”‚       â”‚       â”œâ”€â”€ stg_customers.sql
â”‚       â”‚       â”œâ”€â”€ stg_orders.sql
â”‚       â”‚       â””â”€â”€ stg_payments.sql
â”‚       â””â”€â”€ profiles.yml
â”œâ”€â”€ jaffle_platform_tests
â”‚   â””â”€â”€ __init__.py
â”œâ”€â”€ pyproject.toml
â”œâ”€â”€ raw_customers.csv
â”œâ”€â”€ raw_orders.csv
â”œâ”€â”€ raw_payments.csv
â”œâ”€â”€ src
â”‚   â””â”€â”€ jaffle_platform
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ __pycache__
â”‚       â”‚   â”œâ”€â”€ __init__.cpython-312.pyc
â”‚       â”‚   â””â”€â”€ definitions.cpython-312.pyc
â”‚       â”œâ”€â”€ definitions.py
â”‚       â”œâ”€â”€ defs
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ __pycache__
â”‚       â”‚   â”‚   â””â”€â”€ __init__.cpython-312.pyc
â”‚       â”‚   â”œâ”€â”€ ingest_files
â”‚       â”‚   â”‚   â”œâ”€â”€ component.yaml
â”‚       â”‚   â”‚   â””â”€â”€ replication.yaml
â”‚       â”‚   â””â”€â”€ jdbt
â”‚       â”‚       â””â”€â”€ component.yaml
â”‚       â””â”€â”€ lib
â”‚           â”œâ”€â”€ __init__.py
â”‚           â””â”€â”€ __pycache__
â”‚               â””â”€â”€ __init__.cpython-312.pyc
â””â”€â”€ uv.lock
```
```yaml: src/jaffle_platform/defs/jdbt/component.yaml
type: dagster_dbt.DbtProjectComponent

attributes:
  dbt:
    project_dir: ../../../../dbt/jdbt
```

## [dbtãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æ§‹æˆã‚’æ›´æ–°](https://docs.dagster.io/guides/labs/components/components-etl-pipeline-tutorial#4-update-the-dbt-project-component-configuration)

```yaml: src/jaffle_platform/defs/jdbt/component.yaml
type: dagster_dbt.DbtProjectComponent

attributes:
  dbt:
    project_dir: ../../../../dbt/jdbt
  asset_attributes:
    key: "target/main/{{ node.name }}"
```
```
$ dg check yaml
All components validated successfully.
$ dg dev
```

UI ã‹ã‚‰ `Materialize all` ã—ã¾ã™ã€‚

```
$ duckdb /tmp/jaffle_platform.duckdb -c "SELECT * FROM orders LIMIT 5;"
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ order_id â”‚ customer_id â”‚ order_date â”‚  status   â”‚ credit_card_amount â”‚ coupon_amount â”‚ bank_transfer_amount â”‚ gift_card_amount â”‚ amount â”‚
â”‚  int32   â”‚    int32    â”‚    date    â”‚  varchar  â”‚       double       â”‚    double     â”‚        double        â”‚      double      â”‚ double â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        1 â”‚           1 â”‚ 2018-01-01 â”‚ returned  â”‚               10.0 â”‚           0.0 â”‚                  0.0 â”‚              0.0 â”‚   10.0 â”‚
â”‚        2 â”‚           3 â”‚ 2018-01-02 â”‚ completed â”‚               20.0 â”‚           0.0 â”‚                  0.0 â”‚              0.0 â”‚   20.0 â”‚
â”‚        3 â”‚          94 â”‚ 2018-01-04 â”‚ completed â”‚                0.0 â”‚           1.0 â”‚                  0.0 â”‚              0.0 â”‚    1.0 â”‚
â”‚        4 â”‚          50 â”‚ 2018-01-05 â”‚ completed â”‚                0.0 â”‚          25.0 â”‚                  0.0 â”‚              0.0 â”‚   25.0 â”‚
â”‚        5 â”‚          64 â”‚ 2018-01-05 â”‚ completed â”‚                0.0 â”‚           0.0 â”‚                 17.0 â”‚              0.0 â”‚   17.0 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

## [ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’è‡ªå‹•åŒ–ã™ã‚‹](https://docs.dagster.io/guides/labs/components/components-etl-pipeline-tutorial#automate-the-pipeline)

```
$ dg scaffold dagster.schedule daily_jaffle.py
Using /home/ec2-user/work/mds/jaffle-platform/.venv/bin/dagster-components
$ tree
.
â”œâ”€â”€ dbt
â”‚   â””â”€â”€ jdbt
â”‚       â”œâ”€â”€ README.md
â”‚       â”œâ”€â”€ dbt_project.yml
â”‚       â”œâ”€â”€ models
â”‚       â”‚   â”œâ”€â”€ customers.sql
â”‚       â”‚   â”œâ”€â”€ orders.sql
â”‚       â”‚   â”œâ”€â”€ sources.yml
â”‚       â”‚   â””â”€â”€ stg
â”‚       â”‚       â”œâ”€â”€ stg_customers.sql
â”‚       â”‚       â”œâ”€â”€ stg_orders.sql
â”‚       â”‚       â””â”€â”€ stg_payments.sql
â”‚       â”œâ”€â”€ profiles.yml
â”‚       â””â”€â”€ target
â”‚           â”œâ”€â”€ dbt.log
â”‚           â”œâ”€â”€ jdbt-8ef979d-67083e8
â”‚           â”‚   â”œâ”€â”€ compiled
â”‚           â”‚   â”‚   â””â”€â”€ jdbt
â”‚           â”‚   â”‚       â””â”€â”€ models
â”‚           â”‚   â”‚           â”œâ”€â”€ customers.sql
â”‚           â”‚   â”‚           â”œâ”€â”€ orders.sql
â”‚           â”‚   â”‚           â””â”€â”€ stg
â”‚           â”‚   â”‚               â”œâ”€â”€ stg_customers.sql
â”‚           â”‚   â”‚               â”œâ”€â”€ stg_orders.sql
â”‚           â”‚   â”‚               â””â”€â”€ stg_payments.sql
â”‚           â”‚   â”œâ”€â”€ dbt.log
â”‚           â”‚   â”œâ”€â”€ graph.gpickle
â”‚           â”‚   â”œâ”€â”€ graph_summary.json
â”‚           â”‚   â”œâ”€â”€ manifest.json
â”‚           â”‚   â”œâ”€â”€ partial_parse.msgpack
â”‚           â”‚   â”œâ”€â”€ run
â”‚           â”‚   â”‚   â””â”€â”€ jdbt
â”‚           â”‚   â”‚       â””â”€â”€ models
â”‚           â”‚   â”‚           â”œâ”€â”€ customers.sql
â”‚           â”‚   â”‚           â”œâ”€â”€ orders.sql
â”‚           â”‚   â”‚           â””â”€â”€ stg
â”‚           â”‚   â”‚               â”œâ”€â”€ stg_customers.sql
â”‚           â”‚   â”‚               â”œâ”€â”€ stg_orders.sql
â”‚           â”‚   â”‚               â””â”€â”€ stg_payments.sql
â”‚           â”‚   â”œâ”€â”€ run_results.json
â”‚           â”‚   â””â”€â”€ semantic_manifest.json
â”‚           â”œâ”€â”€ manifest.concurrent-update-lock
â”‚           â”œâ”€â”€ manifest.json
â”‚           â”œâ”€â”€ partial_parse.msgpack
â”‚           â”œâ”€â”€ perf_info.json
â”‚           â””â”€â”€ semantic_manifest.json
â”œâ”€â”€ jaffle_platform_tests
â”‚   â””â”€â”€ __init__.py
â”œâ”€â”€ pyproject.toml
â”œâ”€â”€ raw_customers.csv
â”œâ”€â”€ raw_orders.csv
â”œâ”€â”€ raw_payments.csv
â”œâ”€â”€ src
â”‚   â””â”€â”€ jaffle_platform
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ __pycache__
â”‚       â”‚   â”œâ”€â”€ __init__.cpython-312.pyc
â”‚       â”‚   â””â”€â”€ definitions.cpython-312.pyc
â”‚       â”œâ”€â”€ definitions.py
â”‚       â”œâ”€â”€ defs
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ __pycache__
â”‚       â”‚   â”‚   â””â”€â”€ __init__.cpython-312.pyc
â”‚       â”‚   â”œâ”€â”€ daily_jaffle.py
â”‚       â”‚   â”œâ”€â”€ ingest_files
â”‚       â”‚   â”‚   â”œâ”€â”€ component.yaml
â”‚       â”‚   â”‚   â””â”€â”€ replication.yaml
â”‚       â”‚   â””â”€â”€ jdbt
â”‚       â”‚       â””â”€â”€ component.yaml
â”‚       â””â”€â”€ lib
â”‚           â”œâ”€â”€ __init__.py
â”‚           â””â”€â”€ __pycache__
â”‚               â””â”€â”€ __init__.cpython-312.pyc
â””â”€â”€ uv.lock
```
```py: src/jaffle_platform/defs/daily_jaffle.py
import dagster as dg


@dg.schedule(cron_schedule="@daily", target="*")
def daily_jaffle(context: dg.ScheduleEvaluationContext):
    return dg.RunRequest()

```

# ãŠã‚ã‚Šã«

æ–°ã—ã„ dg cli ã¨æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆã¯ã€ã„ã‹ãŒã§ã—ãŸã‹ï¼Ÿ

component.yaml ã‹ã‚‰ project_dir ãªã©ã§å‚ç…§ã§ãã‚Œã°ã€uv ã®ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹æ©Ÿèƒ½ã‚‚æ´»ç”¨ã—ã¦ã€dlt ã‚„ dbt ã®å˜ä½“ã®æ©Ÿèƒ½ã‚‚æ´»ã‹ã—ã¤ã¤ã€å…¨ä½“ã®çµ±åˆã‚‚ã§ããã†ãªæ°—ãŒã—ã¾ã™ã­ã€‚
