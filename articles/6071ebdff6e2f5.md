---
title: "å…¬å¼ã‚µãƒ³ãƒ—ãƒ«ã‚’å…¬å¼Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã«å…¥ã‚Œã‚‹ï¼ˆPostgreSQLç·¨ï¼‰"
emoji: "ğŸ˜"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["docker", "postgresql", "sql"]
published: true
publication_name: "robon"
---

# ã¯ã˜ã‚ã«
ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒæ¬²ã—ããªã£ãŸã®ã§ã™ãŒã€æœ€è¿‘ã¯è¦‹ã‹ã‘ãªã„ã‚ˆã†ãªæ°—ãŒã—ã¾ã™ã€‚
æ˜”ã€…ã¯ã€scott/tiger ã§ã¤ãªã„ã§ EMP ãƒ†ãƒ¼ãƒ–ãƒ«ã§ç·´ç¿’ã™ã‚‹ã®ãŒãŠç´„æŸã§ã—ãŸãŒâ€¦ã€‚
èª¿ã¹ã¦ã¿ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚

æœ€åˆã¯ã€ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®å ´æ‰€ã ã‘ã®å‚™å¿˜éŒ²ã«ã—ã‚ˆã†ã¨æ€ã£ãŸã®ã§ã™ãŒã€ã¡ã‚‡ã£ã¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½¿ã£ãŸãƒ‡ãƒ¢ã¨ã‹ãƒ†ã‚¹ãƒˆãŒå¿…è¦ã«ãªã£ãŸã®ã§ã€ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å…¥ã‚Šã® Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œã£ã¦ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œã‚‹ææ–™ã‚‚ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚‚å…¬é–‹ã—ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚

# PostgreSQL ç·¨
MySQL ã«ã¯ä¼¼ãŸã‚ˆã†ãªè¨˜äº‹ãŒã„ãã¤ã‹ã‚ã‚Šã¾ã™ï¼ˆè‹¦ç¬‘ï¼‰ã€‚
ãªã®ã«ã€ã‚ãˆã¦ã€æœ€åˆã« PostgreSQL ã‚’ã‚„ã‚‹ç†ç”±ã§ã™ãŒã€å…ƒã€…ã€PostgreSQL ç”¨ã®å…¬å¼ã‚¤ãƒ¡ãƒ¼ã‚¸ã§æ¡ç”¨ã•ã‚ŒãŸæ–¹æ³•ãŒä»–ã«ã‚‚ã‚³ãƒ”ãƒ¼ã•ã‚Œã¦ã„ãŸã‹ã‚‰ã§ã™ã€‚

## å…¬å¼ Docker ã‚¤ãƒ¡ãƒ¼ã‚¸
ã‚ªãƒ•ã‚£ã‚·ãƒ£ãƒ«ã‚¤ãƒ¡ãƒ¼ã‚¸ã¯ã€ä»¥ä¸‹ã«ã‚ã‚Šã¾ã™ã€‚
https://hub.docker.com/_/postgres

ã“ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã—ã¦ã„ã‚‹ã®ãŒã€ä»¥ä¸‹ã§ã™ã€‚
https://github.com/docker-library/postgres

ã“ã®ã‚ªãƒ•ã‚£ã‚·ãƒ£ãƒ«ã‚¤ãƒ¡ãƒ¼ã‚¸ã® `Initialization scripts` ã«æ›¸ã‹ã‚Œã¦ã„ã¾ã™ã€‚

> If you would like to do additional initialization in an image derived from this one, add one or more *.sql, *.sql.gz, or *.sh scripts under /docker-entrypoint-initdb.d (creating the directory if necessary). After the entrypoint calls initdb to create the default postgres user and database, it will run any *.sql files, run any executable *.sh scripts, and source any non-executable *.sh scripts found in that directory to do further initialization before starting the service.

ãªã®ã§ã€`.sql` ã‚„ `.sh` ã‚’ `/docker-entrypoint-initdb.d` ã«ç½®ã„ã¦ãŠã‘ã°è‰¯ã„ã¨ã„ã†ã“ã¨ã§ã™ã€‚

## å…¬å¼ã‚µãƒ³ãƒ—ãƒ«
å…¬å¼ã‚µãƒ³ãƒ—ãƒ«ã¯ã€ä»¥ä¸‹ã«ã‚ã‚Šã¾ã—ãŸã€‚
https://www.postgresql.org/ftp/projects/pgFoundry/dbsamples/

ä»Šå›ã¯ã€`dellstore2` ã‚’çµ„ã¿è¾¼ã‚€ã“ã¨ã«ã—ã¾ã™ã€‚

## Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œã‚‹
æœ¬å½“ã¯ã€ä½œã‚‰ãªãã¦ã‚‚ã€`/docker-entrypoint-initdb.d` ã‚’ `-v` ã§ãƒã‚¦ãƒ³ãƒˆã™ã‚Œã°çµ‚äº†ãªã‚“ã ã‘ã©ã€çµ„ã¿è¾¼ã‚“ã§ã—ã¾ã£ãŸæ–¹ãŒæ¥½ãªã‚“ã˜ã‚ƒãªã„ã®ï¼Ÿã¨ã„ã†ã“ã¨ã§ä½œã‚Šã¾ã™ã€‚

### SQLãƒ•ã‚¡ã‚¤ãƒ«
`dellstore2-normal-1.0.tar.gz` ã‚’è§£å‡ã—ã¦ã€`dellstore2-normal-1.0.sql` ã‚’ä½¿ã„ã¾ã™ã€‚
Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã®å¤§ãã•ã®å•é¡Œã‚‚ã‚ã‚‹ã®ã§ã€build ã™ã‚‹éš›ã¯ã€`dellstore2-normal-1.0.sql.gz` ã«åœ§ç¸®ã—ã¾ã™ã€‚

### Dockerfile
```dockerfile: Dockerfile
FROM postgres
COPY ./dellstore2-normal-1.0/dellstore2-normal-1.0.sql.gz /docker-entrypoint-initdb.d/01.sql.gz
```
ãã®ã¾ã‚“ã¾ã§ã™ã€‚
ã‚³ãƒ”ãƒ¼å…ˆã‚’ 01.sql.gz ã«ã—ã¦ã„ã‚‹ã®ã¯ã€è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã«ãªã£ã¦ã€å®Ÿè¡Œé †ã«åˆ¶ç´„ãŒã‚ã‚‹å ´åˆã«å‚™ãˆã¦ã§ã™ã€‚

### Makefile
```makefile: Makefile
.PHONY: build run push clean

IMAGE=docker.io/take0a/postgres-dellstore2
CONTAINER=postgres01
PASSWORD=password

build: clean
	gzip -k dellstore2-normal-1.0/*.sql 
	docker build . -t $(IMAGE) --no-cache

run:
	docker run --name $(CONTAINER) -dit -e POSTGRES_PASSWORD=$(PASSWORD) $(IMAGE)
	docker exec -it $(CONTAINER) /bin/bash

push:
	docker push $(IMAGE)

clean:
	docker container rm $(CONTAINER) -f
	docker image rm $(IMAGE) -f
	rm -f dellstore2-normal-1.0/*.sql.gz
```
ã“ã‚“ãªæ„Ÿã˜ã«ã—ã¦ãŠãã¨ã€ã‚³ãƒãƒ³ãƒ‰ã‚’å¿˜ã‚Œã¦ã€Œã‚ã‚ã‚ã€ã—ãªãã¦ã™ã¿ã¾ã™ã€‚

## Docker ã‚¤ãƒ¡ãƒ¼ã‚¸
ä»¥ä¸‹ã§å…¬é–‹ã—ã¾ã—ãŸã€‚
https://hub.docker.com/r/take0a/postgres-dellstore2

`docker pull take0a/postgres-dellstore2` ã§ pull ã§ãã¾ã™ã€‚

## GitHub ãƒªãƒã‚¸ãƒˆãƒª
ä»¥ä¸‹ã§å…¬é–‹ã—ã¾ã—ãŸã€‚
https://github.com/take0a/docker-library/tree/main/postgres

ä»–ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚‚ã®ã‚‚å…¬é–‹ã—ãŸã‚‰ã€å°‘ã—ãã‚Œã„ã«ã—ã¦ãŠãã¾ã™ã€‚

# ãŠã‚ã‚Šã«
ã‚„ã¯ã‚Šã€ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¯å¿…è¦ã§ã™ã‚ˆã­ã€‚
